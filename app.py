import streamlit as st
import os
import subprocess
import re
from pathlib import Path
import sys

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.append(str(Path(__file__).parent))

from config import MODULES, COLORS, STREAMLIT_CONFIG, ASSETS_DIR
from interactive import INTERACTIVE_MODULES
from learning_path_ui import render_learning_paths, show_learning_progress, show_concept_map

# é¡µé¢é…ç½® - å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–stå‘½ä»¤ä¹‹å‰
st.set_page_config(
    page_title=STREAMLIT_CONFIG["title"],
    layout=STREAMLIT_CONFIG["layout"],
    page_icon=STREAMLIT_CONFIG["page_icon"]
)

# åœºæ™¯æ–‡ä»¶åå’Œç±»åæ˜ å°„
scene_mappings = {
    "matrix": {
        "matrix_transform": ("MatrixTransformScene", "matrix_transform"),
        "svd_decomposition": ("SVDScene", "matrix_transform"), 
        "eigenvalues": ("EigenvalueScene", "matrix_transform")
    },
    "convolution": {
        "convolution_operation": ("ConvolutionOperationScene", "convolution_operation"),
        "kernel_types": ("KernelTypesScene", "convolution_operation"),
        "feature_extraction": ("FeatureExtractionScene", "convolution_operation")
    },
    "loss": {
        "least_squares": ("LeastSquaresScene", "least_squares"),
        "cross_entropy": ("CrossEntropyScene", "cross_entropy"),
        "gradient_descent": ("Basic3DGradient", "gradient_descent_3d"),
    },
    "optimizer": {
        "sgd": ("SGDScene", "optimizer"),
        "momentum": ("MomentumScene", "optimizer"),
        "adam": ("AdamScene", "optimizer")
    },
    "svm": {
        "margin": ("MarginScene", "svm"),
        "kernel_trick": ("KernelTrickScene", "svm"),
        "dual_problem": ("DualProblemScene", "svm")
    },
    "lagrange": {
        "circle_linear": ("CircleLinearScene", "constraint_optimization"),
        "ellipse_quadratic": ("EllipseQuadraticScene", "constraint_optimization"),
        "svm_dual": ("SVMDualScene", "constraint_optimization"),
        "kkt_conditions": ("KKTConditionsScene", "constraint_optimization")
    }
}

def get_scene_description(module_key, scene_name):
    """è·å–åœºæ™¯çš„è¯¦ç»†æè¿°ï¼Œä½¿ç”¨æ­£ç¡®çš„å…¬å¼"""
    
    # åŸºäºç¬”è®°å†…å®¹çš„æ­£ç¡®æè¿°ï¼ˆå»æ‰$ç¬¦å·ï¼Œè®©Streamlitå¤„ç†ï¼‰
    base_descriptions = {
        "optimizer": {
            "sgd": {
                "title": "éšæœºæ¢¯åº¦ä¸‹é™ (SGD)",
                "description": "SGDæ˜¯æœ€åŸºç¡€çš„ä¼˜åŒ–ç®—æ³•ï¼Œé€šè¿‡éšæœºé€‰æ‹©æ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°ã€‚",
                "key_concepts": [
                    "éšæœºæ€§ï¼šæ¯æ¬¡ä½¿ç”¨å•ä¸ªæ ·æœ¬è®¡ç®—æ¢¯åº¦",
                    "æ”¶æ•›æ€§ï¼šè™½ç„¶è·¯å¾„æŒ¯è¡ï¼Œä½†æœ€ç»ˆä¼šæ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜",
                    "å­¦ä¹ ç‡ï¼šéœ€è¦ä»”ç»†è°ƒæ•´ï¼Œè¿‡å¤§å¯¼è‡´å‘æ•£ï¼Œè¿‡å°æ”¶æ•›æ…¢"
                ],
                "formula": r"\theta \leftarrow \theta - \eta \cdot g",
                "advantages": ["è®¡ç®—æ•ˆç‡é«˜", "å†…å­˜å ç”¨å°", "èƒ½å¤Ÿè·³å‡ºå±€éƒ¨æœ€ä¼˜"],
                "disadvantages": ["æ”¶æ•›é€Ÿåº¦æ…¢", "æ¢¯åº¦æ–¹å·®å¤§", "å¯¹å­¦ä¹ ç‡æ•æ„Ÿ"]
            },
            "momentum": {
                "title": "åŠ¨é‡ä¼˜åŒ–å™¨ (Momentum)",
                "description": "Momentumé€šè¿‡ç´¯ç§¯å†å²æ¢¯åº¦ä¿¡æ¯æ¥åŠ é€Ÿæ”¶æ•›å¹¶å‡å°‘æŒ¯è¡ã€‚",
                "key_concepts": [
                    "åŠ¨é‡ç´¯ç§¯ï¼šé€šè¿‡å†å²æ¢¯åº¦ä¿¡æ¯æ„å»ºåŠ¨é‡",
                    "æƒ¯æ€§æ•ˆåº”ï¼šä¿æŒè¿åŠ¨æ–¹å‘ï¼Œå‡å°‘æŒ¯è¡",
                    "åŠ é€Ÿæ”¶æ•›ï¼šåœ¨ä¸€è‡´æ–¹å‘ä¸ŠåŠ é€Ÿæ›´æ–°"
                ],
                "formula": r"\begin{aligned} v &\leftarrow \mu \cdot v + g \\ \theta &\leftarrow \theta - \eta \cdot v \end{aligned}",
                "advantages": ["æ”¶æ•›æ›´å¿«", "å‡å°‘æŒ¯è¡", "èƒ½å¤Ÿç©¿è¶Šéç‚¹"],
                "disadvantages": ["éœ€è¦è°ƒæ•´åŠ¨é‡å‚æ•°", "å¯èƒ½åœ¨æœ€ä¼˜ç‚¹é™„è¿‘æŒ¯è¡"]
            },
            "adam": {
                "title": "Adamä¼˜åŒ–å™¨",
                "description": "Adamç»“åˆäº†åŠ¨é‡å’Œè‡ªé€‚åº”å­¦ä¹ ç‡ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„ä¼˜åŒ–ç®—æ³•ä¹‹ä¸€ã€‚",
                "key_concepts": [
                    "è‡ªé€‚åº”å­¦ä¹ ç‡ï¼šæ ¹æ®æ¢¯åº¦å†å²è°ƒæ•´æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡",
                    "åŠ¨é‡åŠ é€Ÿï¼šä¸€é˜¶çŸ©ä¼°è®¡æä¾›åŠ¨é‡",
                    "åå·®æ ¡æ­£ï¼šä¿®æ­£åˆå§‹åå·®ï¼Œç¡®ä¿æ— åä¼°è®¡"
                ],
                "formula": r"\begin{aligned} m &\leftarrow \beta_1 \cdot m + (1-\beta_1) \cdot g \\ v &\leftarrow \beta_2 \cdot v + (1-\beta_2) \cdot g^2 \\ \theta &\leftarrow \theta - \eta \cdot \frac{\hat{m}}{\sqrt{\hat{v}} + \epsilon} \end{aligned}",
                "advantages": ["æ”¶æ•›å¿«é€Ÿ", "è‡ªé€‚åº”å­¦ä¹ ç‡", "é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯"],
                "disadvantages": ["å¯èƒ½æ”¶æ•›åˆ°æ¬¡ä¼˜è§£", "è¶…å‚æ•°è¾ƒå¤š", "åœ¨æŸäº›æƒ…å†µä¸‹æ³›åŒ–æ€§å·®"]
            }
        },
        "matrix": {
            "matrix_transform": {
                "title": "çŸ©é˜µå˜æ¢",
                "description": "çŸ©é˜µä¹˜æ³•å¯ä»¥å®ç°çº¿æ€§å˜æ¢ï¼ŒåŒ…æ‹¬æ—‹è½¬ã€ç¼©æ”¾ã€åå°„ç­‰å‡ ä½•æ“ä½œã€‚",
                "key_concepts": [
                    "çº¿æ€§æ˜ å°„ï¼šä¿æŒå‘é‡çš„åŠ æ³•å’Œæ ‡é‡ä¹˜æ³•",
                    "å‡ ä½•æ„ä¹‰ï¼šå˜æ¢ç©ºé—´ä¸­çš„ç‚¹ã€çº¿ã€é¢",
                    "å¤åˆå˜æ¢ï¼šå¤šä¸ªçŸ©é˜µä¹˜æ³•å®ç°å¤æ‚å˜æ¢"
                ],
                "formula": r"\mathbf{y} = f(\mathbf{W}\mathbf{x} + \mathbf{b})",
                "applications": ["è®¡ç®—æœºå›¾å½¢å­¦", "æœºå™¨å­¦ä¹ ç‰¹å¾å˜æ¢", "ç‰©ç†ç³»ç»Ÿå»ºæ¨¡"]
            },
            "svd_decomposition": {
                "title": "å¥‡å¼‚å€¼åˆ†è§£ (SVD)",
                "description": "SVDå°†ä»»æ„çŸ©é˜µåˆ†è§£ä¸ºä¸‰ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ï¼Œæ˜¯çŸ©é˜µåˆ†æçš„é‡è¦å·¥å…·ã€‚",
                "key_concepts": [
                    "åˆ†è§£å½¢å¼ï¼šçŸ©é˜µåˆ†è§£ä¸ºä¸‰ä¸ªç‰¹æ®ŠçŸ©é˜µçš„ä¹˜ç§¯",
                    "å¥‡å¼‚å€¼ï¼šè¡¨ç¤ºçŸ©é˜µåœ¨å„ä¸ªæ–¹å‘ä¸Šçš„æ‹‰ä¼¸ç¨‹åº¦",
                    "å‡ ä½•æ„ä¹‰ï¼šæ—‹è½¬-ç¼©æ”¾-æ—‹è½¬çš„å¤åˆå˜æ¢"
                ],
                "formula": r"\mathbf{W} = \mathbf{U} \mathbf{\Sigma} \mathbf{V}^T",
                "applications": ["æ•°æ®å‹ç¼©", "æ¨èç³»ç»Ÿ", "å›¾åƒå¤„ç†"]
            },
            "eigenvalues": {
                "title": "ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡",
                "description": "ç‰¹å¾å‘é‡æ˜¯åœ¨çŸ©é˜µå˜æ¢ä¸‹ä¿æŒæ–¹å‘ä¸å˜çš„å‘é‡ï¼Œç‰¹å¾å€¼è¡¨ç¤ºç¼©æ”¾æ¯”ä¾‹ã€‚",
                "key_concepts": [
                    "ç‰¹å¾æ–¹ç¨‹ï¼šç‰¹å®šå‘é‡åœ¨å˜æ¢ä¸‹çš„æ€§è´¨",
                    "å‡ ä½•æ„ä¹‰ï¼šå˜æ¢çš„ä¸»è½´æ–¹å‘",
                    "è°±åˆ†è§£ï¼šåŸºäºç‰¹å¾å€¼çš„çŸ©é˜µåˆ†è§£"
                ],
                "formula": r"\mathbf{A}\mathbf{v} = \lambda \mathbf{v}",
                "applications": ["ä¸»æˆåˆ†åˆ†æ", "æŒ¯åŠ¨åˆ†æ", "é‡å­åŠ›å­¦"]
            }
        },
        "convolution": {
            "convolution_operation": {
                "title": "å·ç§¯è¿ç®—",
                "description": "å·ç§¯æ˜¯ä¿¡å·å¤„ç†å’Œæ·±åº¦å­¦ä¹ ä¸­çš„æ ¸å¿ƒæ“ä½œï¼Œé€šè¿‡æ»‘åŠ¨çª—å£å®ç°ç‰¹å¾æå–ã€‚",
                "key_concepts": [
                    "æ»‘åŠ¨çª—å£ï¼šå·ç§¯æ ¸åœ¨è¾“å…¥ä¸Šæ»‘åŠ¨",
                    "é€å…ƒç´ ç›¸ä¹˜ï¼šæ ¸ä¸å¯¹åº”åŒºåŸŸå…ƒç´ ç›¸ä¹˜",
                    "æ±‚å’Œï¼šå°†ä¹˜ç§¯ç»“æœæ±‚å’Œå¾—åˆ°è¾“å‡º"
                ],
                "formula": r"(f * g)[n] = \sum_{i=-\infty}^{\infty} f[i]g[n-i]",
                "applications": ["å›¾åƒæ»¤æ³¢", "ç‰¹å¾æå–", "ä¿¡å·å¤„ç†"]
            },
            "kernel_types": {
                "title": "å·ç§¯æ ¸ç±»å‹",
                "description": "ä¸åŒç±»å‹çš„å·ç§¯æ ¸èƒ½å¤Ÿæå–ä¸åŒçš„ç‰¹å¾ï¼Œå¦‚è¾¹ç¼˜ã€çº¹ç†ã€å½¢çŠ¶ç­‰ã€‚",
                "key_concepts": [
                    "è¾¹ç¼˜æ£€æµ‹ï¼šSobelã€Prewittç®—å­",
                    "æ¨¡ç³Šå¤„ç†ï¼šé«˜æ–¯æ ¸",
                    "é”åŒ–ï¼šæ‹‰æ™®æ‹‰æ–¯ç®—å­"
                ],
            },
            "feature_extraction": {
                "title": "ç‰¹å¾æå–",
                "description": "å·ç§¯ç½‘ç»œé€šè¿‡å¤šå±‚å·ç§¯é€æ­¥æå–ä»ä½çº§åˆ°é«˜çº§çš„ç‰¹å¾ã€‚",
                "key_concepts": [
                    "å±‚æ¬¡ç‰¹å¾ï¼šä»è¾¹ç¼˜â†’çº¹ç†â†’éƒ¨ä»¶â†’å¯¹è±¡",
                    "æ„Ÿå—é‡ï¼šæ¯ä¸ªç¥ç»å…ƒçœ‹åˆ°çš„è¾“å…¥åŒºåŸŸ",
                    "ç‰¹å¾å›¾ï¼šå·ç§¯æ“ä½œçš„è¾“å‡ºç»“æœ"
                ],
                "applications": ["å›¾åƒè¯†åˆ«", "ç›®æ ‡æ£€æµ‹", "è¯­ä¹‰åˆ†å‰²"]
            }
        },
        "loss": {
            "least_squares": {
                "title": "æœ€å°äºŒä¹˜æ³•",
                "description": "æœ€å°äºŒä¹˜æ³•é€šè¿‡æœ€å°åŒ–é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„å¹³æ–¹å·®æ¥æ‹Ÿåˆæ¨¡å‹ã€‚",
                "key_concepts": [
                    "å¹³æ–¹è¯¯å·®ï¼šé¢„æµ‹å€¼ä¸çœŸå®å€¼çš„å·®å€¼å¹³æ–¹",
                    "å‡ ä½•æ„ä¹‰ï¼šæœ€å°åŒ–æ®‹å·®å‘é‡çš„æ¬§å‡ é‡Œå¾—è·ç¦»",
                    "è§£æè§£ï¼šæ­£è§„æ–¹ç¨‹æ±‚è§£"
                ],
                "formula": r"L = \sum_{i=1}^{n}(y_i - \hat{y}_i)^2",
                "applications": ["çº¿æ€§å›å½’", "æ›²çº¿æ‹Ÿåˆ", "å‚æ•°ä¼°è®¡"]
            },
            "cross_entropy": {
                "title": "äº¤å‰ç†µæŸå¤±",
                "description": "äº¤å‰ç†µè¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒçš„å·®å¼‚ï¼Œæ˜¯åˆ†ç±»ä»»åŠ¡ä¸­æœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°ã€‚",
                "key_concepts": [
                    "ä¿¡æ¯ç†µï¼šè¡¡é‡ä¸ç¡®å®šæ€§çš„åº¦é‡",
                    "KLæ•£åº¦ï¼šç›¸å¯¹ç†µï¼Œè¡¡é‡åˆ†å¸ƒå·®å¼‚",
                    "åˆ†ç±»æŸå¤±ï¼šå¤šåˆ†ç±»å’ŒäºŒåˆ†ç±»å½¢å¼"
                ],
                "formula": r"L = -\sum_{i=1}^{n} y_i \log(\hat{y}_i)",
                "applications": ["åˆ†ç±»ä»»åŠ¡", "æ¦‚ç‡æ¨¡å‹", "ä¿¡æ¯è®º"]
            },
            "gradient_descent": {
                "title": "æ¢¯åº¦ä¸‹é™",
                "description": "æ¢¯åº¦ä¸‹é™é€šè¿‡æ²¿ç€è´Ÿæ¢¯åº¦æ–¹å‘è¿­ä»£æ›´æ–°å‚æ•°æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚",
                "key_concepts": [
                    "æ¢¯åº¦æ–¹å‘ï¼šå‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘",
                    "æ­¥é•¿é€‰æ‹©ï¼šå­¦ä¹ ç‡çš„é‡è¦æ€§",
                    "æ”¶æ•›æ¡ä»¶ï¼šæ¢¯åº¦æ¥è¿‘é›¶æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°"
                ],
                "formula": r"\theta_{t+1} = \theta_t - \eta \nabla L(\theta_t)",
                "variants": ["æ‰¹é‡æ¢¯åº¦ä¸‹é™", "éšæœºæ¢¯åº¦ä¸‹é™", "å°æ‰¹é‡æ¢¯åº¦ä¸‹é™"]
            }
        },
        "svm": {
            "margin": {
                "title": "æ”¯æŒå‘é‡æœºä¸é—´éš”",
                "description": "SVMé€šè¿‡æ‰¾åˆ°æœ€å¤§é—´éš”è¶…å¹³é¢æ¥å®ç°åˆ†ç±»ï¼Œé—´éš”è¶Šå¤§æ¨¡å‹æ³›åŒ–èƒ½åŠ›è¶Šå¼ºã€‚",
                "key_concepts": [
                    "é—´éš”ï¼šåˆ†ç±»è¾¹ç•Œåˆ°æœ€è¿‘æ ·æœ¬çš„è·ç¦»",
                    "æ”¯æŒå‘é‡ï¼šå†³å®šè¾¹ç•Œçš„ä¸´ç•Œæ ·æœ¬",
                    "æœ€å¤§é—´éš”ï¼šæœ€ä¼˜åˆ†ç±»å™¨çš„å‡ ä½•è§£é‡Š"
                ],
                "applications": ["æ–‡æœ¬åˆ†ç±»", "ç”Ÿç‰©ä¿¡æ¯å­¦", "å›¾åƒè¯†åˆ«"]
            },
            "kernel_trick": {
                "title": "æ ¸æŠ€å·§",
                "description": "æ ¸æŠ€å·§é€šè¿‡æ˜ å°„å‡½æ•°å°†æ•°æ®è½¬æ¢åˆ°é«˜ç»´ç©ºé—´ï¼Œä½¿çº¿æ€§ä¸å¯åˆ†é—®é¢˜å˜å¾—çº¿æ€§å¯åˆ†ã€‚",
                "key_concepts": [
                    "ç‰¹å¾æ˜ å°„ï¼šå°†æ•°æ®æ˜ å°„åˆ°é«˜ç»´ç©ºé—´",
                    "æ ¸å‡½æ•°ï¼šé«˜ç»´ç©ºé—´ä¸­çš„å†…ç§¯è®¡ç®—",
                    " Mercerå®šç†ï¼šæ ¸å‡½æ•°çš„å……è¦æ¡ä»¶"
                ],
                "kernels": ["çº¿æ€§æ ¸", "å¤šé¡¹å¼æ ¸", "RBFæ ¸", "Sigmoidæ ¸"]
            },
            "dual_problem": {
                "title": "å¯¹å¶é—®é¢˜",
                "description": "SVMçš„å¯¹å¶å½¢å¼é€šè¿‡æ‹‰æ ¼æœ—æ—¥ä¹˜å­å°†åŸé—®é¢˜è½¬åŒ–ä¸ºå¯¹å¶é—®é¢˜ï¼Œä¾¿äºæ ¸æŠ€å·§çš„åº”ç”¨ã€‚",
                "key_concepts": [
                    "æ‹‰æ ¼æœ—æ—¥ä¹˜å­ï¼šçº¦æŸä¼˜åŒ–çš„æ•°å­¦å·¥å…·",
                    "KKTæ¡ä»¶ï¼šæœ€ä¼˜è§£çš„å¿…è¦æ¡ä»¶",
                    "å¯¹å¶æ€§ï¼šåŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜çš„å…³ç³»"
                ],
                "advantages": ["è‡ªç„¶å¼•å…¥æ ¸å‡½æ•°", "æ”¯æŒå‘é‡ç¡®å®š", "å‡¸ä¼˜åŒ–ä¿è¯å…¨å±€æœ€ä¼˜"]
            }
        },
        "lagrange": {
            "circle_linear": {
                "title": "åœ†å½¢çº¦æŸ-çº¿æ€§ç›®æ ‡",
                "description": "åœ¨å•ä½åœ†çº¦æŸä¸‹æœ€å¤§åŒ–çº¿æ€§ç›®æ ‡å‡½æ•°ï¼Œå±•ç¤ºæ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•çš„åŸºæœ¬åŸç†ã€‚",
                "key_concepts": [
                    "æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼šL(x,y,Î») = f(x,y) + Î»g(x,y)",
                    "æ¢¯åº¦å¹³è¡Œæ¡ä»¶ï¼šâˆ‡f = Î»âˆ‡g",
                    "å‡ ä½•è§£é‡Šï¼šç­‰é«˜çº¿ä¸çº¦æŸæ›²çº¿ç›¸åˆ‡"
                ],
                "formula": "\\mathcal{L}(x,y,\\lambda) = x + y - \\lambda(x^2 + y^2 - 1)",
                "applications": ["çº¦æŸä¼˜åŒ–å…¥é—¨", "å‡ ä½•ç›´è§‚ç†è§£", "è§£ææ±‚è§£æ¼”ç¤º"]
            },
            "ellipse_quadratic": {
                "title": "æ¤­åœ†çº¦æŸ-äºŒæ¬¡ç›®æ ‡",
                "description": "åœ¨æ¤­åœ†çº¦æŸä¸‹æœ€å°åŒ–äºŒæ¬¡ç›®æ ‡å‡½æ•°ï¼Œå±•ç¤ºæ›´å¤æ‚çº¦æŸçš„å¤„ç†æ–¹æ³•ã€‚",
                "key_concepts": [
                    "ä¸€èˆ¬çº¦æŸå½¢å¼ï¼šg(x,y) = xÂ²/aÂ² + yÂ²/bÂ² - 1 = 0",
                    "æ•°å€¼æ±‚è§£ï¼šå½“è§£æè§£å¤æ‚æ—¶çš„å¤„ç†æ–¹æ³•",
                    "è·ç¦»ä¼˜åŒ–ï¼šä»åŸç‚¹åˆ°æ¤­åœ†çš„æœ€çŸ­è·ç¦»"
                ],
                "formula": r"\min_{{x,y}} x^2 + y^2 \quad \text{{s.t.}} \quad \frac{{x^2}}{{a^2}} + \frac{{y^2}}{{b^2}} = 1",
                "applications": ["å‚æ•°ä¼˜åŒ–", "èµ„æºåˆ†é…", "å·¥ç¨‹è®¾è®¡"]
            },
            "svm_dual": {
                "title": "SVMå¯¹å¶é—®é¢˜",
                "description": "é€šè¿‡æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æ¨å¯¼SVMçš„å¯¹å¶å½¢å¼ï¼Œå±•ç¤ºå¯¹å¶é—®é¢˜åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨ã€‚",
                "key_concepts": [
                    "åŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜çš„è½¬æ¢",
                    "æ”¯æŒå‘é‡ä¸æ‹‰æ ¼æœ—æ—¥ä¹˜å­çš„å…³ç³»",
                    "æ ¸æŠ€å·§çš„è‡ªç„¶å¼•å…¥"
                ],
                "formula": r"\max_{\alpha} \sum_i \alpha_i - \frac{1}{2}\sum_{i,j}\alpha_i\alpha_j y_i y_j \langle x_i, x_j \rangle",
                "applications": ["æ”¯æŒå‘é‡æœº", "æ¨¡å¼è¯†åˆ«", "åˆ†ç±»é—®é¢˜"]
            },
            "kkt_conditions": {
                "title": "KKTæ¡ä»¶",
                "description": "Karush-Kuhn-Tuckeræ¡ä»¶æ˜¯çº¦æŸä¼˜åŒ–çš„æœ€ä¼˜æ€§å¿…è¦æ¡ä»¶ï¼ŒåŒ…å«äº’è¡¥æ¾å¼›ç­‰é‡è¦æ¦‚å¿µã€‚",
                "key_concepts": [
                    "åŸå§‹å¯è¡Œæ€§ï¼šg(x) â‰¤ 0, h(x) = 0",
                    "å¯¹å¶å¯è¡Œæ€§ï¼šÎ¼ â‰¥ 0",
                    "äº’è¡¥æ¾å¼›ï¼šÎ¼Â·g(x) = 0"
                ],
                "formula": r"\nabla f(x^*) + \sum_i \mu_i \nabla g_i(x^*) + \sum_j \lambda_j \nabla h_j(x^*) = 0",
                "applications": ["ä¸ç­‰å¼çº¦æŸ", "ä¼˜åŒ–ç†è®º", "æœºå™¨å­¦ä¹ ç®—æ³•"]
            }
        },
        "neural_geometry": {
            "scaling_laws": {
                "title": "å‚æ•°ç¼©æ”¾å®šå¾‹",
                "description": "åˆ†æä¸åŒç¥ç»ç½‘ç»œæ¶æ„çš„å‚æ•°é‡éšæ¨¡å‹ç»´åº¦çš„å¢é•¿è¶‹åŠ¿ï¼Œç†è§£Scaling Lawsçš„æ•°å­¦æœ¬è´¨ã€‚",
                "key_concepts": [
                    r"äºŒæ¬¡æ–¹å…³ç³»ï¼šå‚æ•°é‡ä¸ç»´åº¦å‘ˆ $N \propto D^2$",
                    "æ¶æ„æ•ˆç‡ï¼šä¸åŒæ¶æ„çš„å‚æ•°å¼€é”€å¯¹æ¯”",
                    "ç»´åº¦è§„åˆ’ï¼šå¦‚ä½•åœ¨æœ‰é™èµ„æºä¸‹é€‰æ‹©åˆé€‚çš„æ¨¡å‹ç»´åº¦"
                ],
                "formula": r"N_{transformer} \approx 12 d_{model}^2",
                "applications": ["æ¨¡å‹è®¾è®¡", "èµ„æºè§„åˆ’", "æ€§èƒ½é¢„æµ‹"]
            },
            "architecture_comparison": {
                "title": "æ¶æ„å¯¹æ¯”åˆ†æ",
                "description": "è¯¦ç»†å¯¹æ¯”Linearã€CNNã€RNNã€LSTMã€Transformerã€Mambaç­‰æ¶æ„çš„å‚æ•°æ„æˆå’Œè®¡ç®—å¤æ‚åº¦ã€‚",
                "key_concepts": [
                    "å‚æ•°æ„æˆï¼šå„ç»„ä»¶çš„å‚æ•°é‡åˆ†è§£",
                    "è®¡ç®—å¤æ‚åº¦ï¼šæ—¶é—´å’Œç©ºé—´å¤æ‚åº¦åˆ†æ",
                    "å†…å­˜å¤æ‚åº¦ï¼šæ¨ç†æ—¶çš„å†…å­˜éœ€æ±‚"
                ],
                "formula": r"\begin{aligned} N_{attn} &\approx 4 d_{model}^2 \ N_{ffn} &= 8 d_{model}^2 \end{aligned}",
                "applications": ["æ¶æ„é€‰æ‹©", "æ€§èƒ½ä¼˜åŒ–", "ç¡¬ä»¶é€‚é…"]
            },
            "geometry_flow": {
                "title": "å¼ é‡å‡ ä½•æµåŠ¨",
                "description": "å¯è§†åŒ–å¼ é‡åœ¨ç¥ç»ç½‘ç»œå„å±‚ä¸­çš„å½¢çŠ¶å˜åŒ–ï¼Œç†è§£æ•°æ®çš„æ‹“æ‰‘å˜æ¢è¿‡ç¨‹ã€‚",
                "key_concepts": [
                    "å¼ é‡å½¢çŠ¶ï¼š$(B, C, H, W)$ åˆ° $(B, T, D)$ çš„å˜æ¢",
                    "å‚æ•°åˆ†å¸ƒï¼šå„å±‚å‚æ•°é‡çš„çƒ­åŠ›å›¾åˆ†æ",
                    "æµåŠ¨è·¯å¾„ï¼šæ•°æ®åœ¨ç½‘ç»œä¸­çš„ä¼ æ’­è½¨è¿¹"
                ],
                "formula": r"\mathbf{y} = \mathbf{W}\mathbf{x} + \mathbf{b}",
                "applications": ["ç½‘ç»œè®¾è®¡", "è°ƒè¯•åˆ†æ", "æ€§èƒ½ä¼˜åŒ–"]
            },
            "lora_decomposition": {
                "title": "LoRAä½ç§©åˆ†è§£",
                "description": "æ·±å…¥ç†è§£LoRAå¦‚ä½•é€šè¿‡ä½ç§©åˆ†è§£å¤§å¹…å‡å°‘å¯è®­ç»ƒå‚æ•°ï¼Œå®ç°é«˜æ•ˆçš„å¤§æ¨¡å‹å¾®è°ƒã€‚",
                "key_concepts": [
                    "ä½ç§©å‡è®¾ï¼šæƒé‡æ›´æ–°å‘ç”Ÿåœ¨ä½ç»´å­ç©ºé—´",
                    "å‚æ•°å‹ç¼©ï¼š$\frac{2r}{d_{model}}$ çš„å‹ç¼©æ¯”",
                    "å‡ ä½•æ„ä¹‰ï¼šå­ç©ºé—´æŠ•å½±çš„æ•°å­¦åŸç†"
                ],
                "formula": r"\mathbf{W}_{new} = \mathbf{W}_{old} + \mathbf{B}\mathbf{A}",
                "applications": ["å¤§æ¨¡å‹å¾®è°ƒ", "å‚æ•°é«˜æ•ˆè®­ç»ƒ", "ç§»åŠ¨ç«¯éƒ¨ç½²"]
            }
        },
        "hilbert_space": {
            "fourier_basics": {
                "title": "å‚…é‡Œå¶å˜æ¢åŸºç¡€",
                "description": "æ¢ç´¢å‚…é‡Œå¶å˜æ¢çš„æ•°å­¦æœ¬è´¨ï¼Œç†è§£æ—¶åŸŸä¸é¢‘åŸŸçš„å¯¹å¶å…³ç³»ï¼ŒéªŒè¯Parsevalæ’ç­‰å¼ã€‚",
                "key_concepts": [
                    "é…‰å˜æ¢æ€§è´¨ï¼šä¿æŒå†…ç§¯å’ŒèŒƒæ•°ä¸å˜",
                    "æ—¶é¢‘å¯¹å¶ï¼šä¿¡å·åœ¨ä¸åŒåŸŸä¸­çš„è¡¨ç¤º",
                    "Parsevalæ’ç­‰å¼ï¼šèƒ½é‡å®ˆæ’çš„æ•°å­¦è¡¨è¾¾"
                ],
                "formula": r"\\mathcal{F}[f](\\omega) = \\int f(x)e^{-i\\langle\\omega,x\\rangle}dx",
                "applications": ["ä¿¡å·å¤„ç†", "å›¾åƒåˆ†æ", "ç¥ç»ç½‘ç»œç†è®º"]
            },
            "convolution_theorem": {
                "title": "å·ç§¯å®šç†æ¼”ç¤º",
                "description": "æ·±å…¥ç†è§£å·ç§¯å®šç†çš„æ•°å­¦è¯æ˜ï¼ŒéªŒè¯æ—¶åŸŸå·ç§¯ä¸é¢‘åŸŸç›¸ä¹˜çš„ç­‰ä»·æ€§ã€‚",
                "key_concepts": [
                    "å·ç§¯å®šç†ï¼š$\\mathcal{F}[f*g] = \\mathcal{F}[f] \\cdot \\mathcal{F}[g]$",
                    "ç‰¹å¾å‡½æ•°ï¼šå¤æŒ‡æ•°å‡½æ•°æ˜¯å·ç§¯ç®—å­çš„ç‰¹å¾å‡½æ•°",
                    "å¯¹è§’åŒ–ï¼šé¢‘åŸŸä¸­å·ç§¯ç®—å­å˜ä¸ºå¯¹è§’çŸ©é˜µ"
                ],
                "formula": r"\\widehat{f * g} = \\hat{f} \\cdot \\hat{g}",
                "applications": ["CNNç†è®º", "ä¿¡å·å¤„ç†", "å¿«é€Ÿç®—æ³•"]
            },
            "cnn_frequency": {
                "title": "CNNé¢‘åŸŸåˆ†æ",
                "description": "åˆ†æCNNæ»¤æ³¢å™¨çš„é¢‘åŸŸç‰¹æ€§ï¼Œç†è§£ä¸åŒå±‚æ¬¡ç½‘ç»œçš„é¢‘ç‡å­¦ä¹ æ¨¡å¼ã€‚",
                "key_concepts": [
                    "ä½é€šç‰¹æ€§ï¼šè®­ç»ƒåçš„æ»¤æ³¢å™¨å¤šå‘ˆä½é€šç‰¹æ€§",
                    "å±‚æ¬¡åŒ–å­¦ä¹ ï¼šæµ…å±‚å­¦åŸºç¡€é¢‘ç‡ï¼Œæ·±å±‚å­¦ç²¾ç»†é¢‘ç‡",
                    "è‡ªç„¶å›¾åƒåç½®ï¼šèƒ½é‡ä¸»è¦é›†ä¸­åœ¨ä½é¢‘æˆåˆ†"
                ],
                "formula": r"h_{l+1} = \\sigma(\\mathcal{F}^{-1}(\\hat{W}_l \\odot \\hat{h}_l) + b_l)",
                "applications": ["ç½‘ç»œè®¾è®¡", "ç‰¹å¾åˆ†æ", "å¯è§£é‡Šæ€§ç ”ç©¶"]
            },
            "graph_fourier": {
                "title": "å›¾å‚…é‡Œå¶å˜æ¢",
                "description": "å°†å‚…é‡Œå¶å˜æ¢æ¨å¹¿åˆ°å›¾ç»“æ„ï¼Œç†è§£å›¾å·ç§¯ç½‘ç»œçš„æ•°å­¦åŸºç¡€ã€‚",
                "key_concepts": [
                    "å›¾æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼š$L = D - A$ çš„ç‰¹å¾åˆ†è§£",
                    "å›¾é¢‘ç‡ï¼šç‰¹å¾å€¼å¯¹åº”å›¾çš„æŒ¯è¡æ¨¡å¼",
                    "è°±å·ç§¯ï¼š$g_\\theta * x = U g_\\theta(\\Lambda) U^T x$"
                ],
                "formula": r"\\hat{x} = U^T x \\quad \\text{(å›¾å‚…é‡Œå¶å˜æ¢)}",
                "applications": ["å›¾ç¥ç»ç½‘ç»œ", "ç¤¾äº¤ç½‘ç»œåˆ†æ", "åˆ†å­ç»“æ„å­¦ä¹ "]
            }
        },
        "diffusion_model": {
            "diffusion_process": {
                "title": "æ‰©æ•£è¿‡ç¨‹æ¼”ç¤º",
                "description": "å¯è§†åŒ–å‰å‘æ‰©æ•£ï¼ˆç†µå¢ï¼‰å’Œé€†å‘ç”Ÿæˆï¼ˆæ—¶é—´å€’æµï¼‰è¿‡ç¨‹ï¼Œç†è§£æ‰©æ•£æ¨¡å‹çš„ç‰©ç†æœ¬è´¨ã€‚",
                "key_concepts": [
                    "å‰å‘SDEï¼šæ•°æ®é€æ¸å˜æˆå™ªå£°",
                    "é€†å‘SDEï¼šå™ªå£°é€æ¸å˜æˆæ•°æ®",
                    "ç†µå¢åŸç†ï¼šä»æœ‰åºåˆ°æ— åºçš„è‡ªç„¶è¿‡ç¨‹",
                    "æ—¶é—´å€’æµï¼šAIå­¦ä¹ è®©æ—¶é—´å€’æµçš„åŠ›åœº"
                ],
                "formula": r"dX_t = f(x_t, t)dt + g(t)dW_t",
                "applications": ["ç”Ÿæˆå¼AI", "å›¾åƒç”Ÿæˆ", "è§†é¢‘åˆæˆ"]
            },
            "score_function": {
                "title": "å¾—åˆ†å‡½æ•°å¯è§†åŒ–",
                "description": "æ¢ç´¢å¾—åˆ†å‡½æ•°çš„ç‰©ç†æ„ä¹‰ï¼Œç†è§£æ¦‚ç‡ç©ºé—´ä¸­çš„åŠ›åœºå’Œæ¢¯åº¦æ–¹å‘ã€‚",
                "key_concepts": [
                    r"å¾—åˆ†å‡½æ•°ï¼š$\nabla_{x_t} \log p_t(x_t)$ï¼ŒæŒ‡å‘æ•°æ®å¯†åº¦å¢åŠ æœ€å¿«çš„æ–¹å‘",
                    "ç‰©ç†æ„ä¹‰ï¼šæ¦‚ç‡å¯†åº¦çš„æ¢¯åº¦ = ç‰©ç†åŠ›åœº",
                    r"å™ªå£°é¢„æµ‹ï¼š$\epsilon$ ä¸å¾—åˆ†å‡½æ•°çš„ç­‰ä»·æ€§",
                    "åŠ›åœºå­¦ä¹ ï¼šç¥ç»ç½‘ç»œå­¦ä¹ çš„æ˜¯è¿™ä¸ªåŠ›åœº"
                ],
                "formula": r"s_\\theta(x,t) \\approx \\nabla_{x_t} \\log p_t(x_t) = -\\frac{\\epsilon}{\\sigma_t}",
                "applications": ["Score Matching", "å»å™ªè¿‡ç¨‹", "æ¦‚ç‡å»ºæ¨¡"]
            },
            "sde_solvers": {
                "title": "SDEæ±‚è§£å™¨å¯¹æ¯”",
                "description": "å¯¹æ¯”ä¸åŒçš„SDEæ±‚è§£å™¨ï¼Œç†è§£ç”Ÿæˆé€Ÿåº¦ä¸è´¨é‡çš„æƒè¡¡ã€‚",
                "key_concepts": [
                    "Euler-Maruyamaï¼šç»å…¸éšæœºå¾®åˆ†æ–¹ç¨‹æ±‚è§£å™¨",
                    "DDIMï¼šç¡®å®šæ€§ODEæ±‚è§£å™¨ï¼Œå¯åŠ é€Ÿé‡‡æ ·",
                    "DPM-Solverï¼šé«˜çº§æ±‚è§£å™¨ï¼Œå¹³è¡¡è´¨é‡ä¸é€Ÿåº¦",
                    "æ•°å€¼ç¨³å®šæ€§ï¼šä¸åŒæ±‚è§£å™¨çš„æ”¶æ•›ç‰¹æ€§"
                ],
                "formula": r"x_{t-1} = x_t - [f(x_t, t) - g(t)^2 s_\\theta(x_t, t)]\\Delta t + g(t)\\sqrt{|\\Delta t|} z",
                "applications": ["é‡‡æ ·åŠ é€Ÿ", "è´¨é‡ä¼˜åŒ–", "å·¥ä¸šéƒ¨ç½²"]
            },
            "langevin_dynamics": {
                "title": "æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦",
                "description": "åœ¨èƒ½é‡åœ°å½¢å›¾ä¸Šç†è§£é‡‡æ ·è¿‡ç¨‹ï¼Œè¿æ¥æ‰©æ•£æ¨¡å‹ä¸èƒ½é‡æ¨¡å‹ã€‚",
                "key_concepts": [
                    r"èƒ½é‡åœ°å½¢ï¼š$p(x) \propto e^{-E(x)}$ï¼Œæ•°æ®åœ¨ä½èƒ½é‡åŒºåŸŸ",
                    r"æœ—ä¹‹ä¸‡é‡‡æ ·ï¼š$x_{new} = x + \eta \nabla_x \log p(x) + \sqrt{2\eta} z$",
                    "ç‰©ç†ç±»æ¯”ï¼šåœ¨Loss Landscapeä¸Šçš„å¸¦å™ªå£°æ¢¯åº¦ä¸‹é™",
                    "æ¸©åº¦å‚æ•°ï¼šæ§åˆ¶éšæœºæ€§ä¸ç¡®å®šæ€§çš„å¹³è¡¡"
                ],
                "formula": r"\\nabla_{x_t} \\log p_t(x_t) = -\\nabla_{x_t} E(x_t)",
                "applications": ["èƒ½é‡æ¨¡å‹", "MCMCé‡‡æ ·", "ç‰©ç†å»ºæ¨¡"]
            }
        },
        "kernel_regression": {
            "kernel_basics": {
                "title": "æ ¸å›å½’åŸºç¡€",
                "description": "ä»Nadaraya-Watsonæ ¸ä¼°è®¡å™¨æ¨å¯¼Attentionæœºåˆ¶ï¼Œç†è§£æ ¸å‡½æ•°çš„æ•°å­¦æœ¬è´¨ã€‚",
                "key_concepts": [
                    "Nadaraya-Watsonä¼°è®¡å™¨ï¼šåŠ æƒæ ¸å›å½’çš„éå‚æ•°æ–¹æ³•",
                    "æ ¸å‡½æ•°é€‰æ‹©ï¼šé«˜æ–¯æ ¸ã€æ‹‰æ™®æ‹‰æ–¯æ ¸ã€å¤šé¡¹å¼æ ¸",
                    "æƒé‡å½’ä¸€åŒ–ï¼šå½¢æˆæ¦‚ç‡åˆ†å¸ƒçš„é…åˆ†å‡½æ•°",
                    "å¸¦å®½å‚æ•°ï¼šæ§åˆ¶å±€éƒ¨æ€§ä¸å…¨å±€æ€§çš„æƒè¡¡"
                ],
                "formula": r"\\hat{v} = \\sum_i \\frac{K(q,k_i)}{\\sum_j K(q,k_j)} v_i",
                "applications": ["éå‚æ•°ä¼°è®¡", "å‡½æ•°é€¼è¿‘", "Attentionç†è®º"]
            },
            "attention_mechanism": {
                "title": "æ³¨æ„åŠ›æœºåˆ¶",
                "description": "æ·±å…¥ç†è§£Attentionçš„æ•°å­¦åŸç†ï¼Œä»æ ¸å›å½’åˆ°åŠ¨æ€æƒé‡ç”Ÿæˆã€‚",
                "key_concepts": [
                    "å¯å¾®å­—å…¸æŸ¥è¯¢ï¼šæ¨¡ç³Šçš„å“ˆå¸Œè¡¨å®ç°",
                    "æ–¹å·®ç¨³å®šï¼šç¼©æ”¾å› å­$\\sqrt{d_k}$çš„æ¦‚ç‡è®ºæ„ä¹‰",
                    "ç½®æ¢ä¸å˜æ€§ï¼šAttentionä¸¢å¤±ä½ç½®ä¿¡æ¯çš„æ•°å­¦æœ¬è´¨",
                    "å› æœé®è”½ï¼šå®ç°è‡ªå›å½’ç”Ÿæˆçš„å…³é”®æŠ€æœ¯"
                ],
                "formula": r"Attention(Q,K,V) = \\text{softmax}\\left(\\frac{QK^T}{\\sqrt{d_k}}\\right)V",
                "applications": ["Transformer", "GPT", "BERT", "æœºå™¨ç¿»è¯‘"]
            },
            "multi_head_attention": {
                "title": "å¤šå¤´æ³¨æ„åŠ›",
                "description": "åˆ†æå¤šå¤´æœºåˆ¶å¦‚ä½•çªç ´ç§©äºç“¶é¢ˆï¼Œå®ç°åŠŸèƒ½åˆ†å·¥ã€‚",
                "key_concepts": [
                    "ä½ç§©ç“¶é¢ˆï¼š$Rank(QK^T) \\leq d_k < N$çš„è¡¨è¾¾é™åˆ¶",
                    "ç§©çš„æ¢å¤ï¼šå¤šä¸ªä½ç§©çŸ©é˜µæ‹¼æ¥é€¼è¿‘é«˜ç§©çŸ©é˜µ",
                    "å­ç©ºé—´æŠ•å½±ï¼šä¸åŒå¤´å­¦ä¹ ä¸åŒçš„ç›¸ä¼¼åº¦åº¦é‡",
                    "åŠŸèƒ½åˆ†å·¥ï¼šè¯­æ³•ã€ä½ç½®ã€é•¿è·ç¦»ä¾èµ–çš„ä¸“é—¨åŒ–"
                ],
                "formula": r"MultiHead(Q,K,V) = Concat(head_1, \\cdots, head_h) W^O",
                "applications": ["å¹¶è¡Œè®¡ç®—", "ç‰¹å¾å¤šæ ·æ€§", "è¡¨è¾¾èƒ½åŠ›æå‡"]
            },
            "linear_attention": {
                "title": "çº¿æ€§Attention",
                "description": "ä¼˜åŒ–å¤æ‚åº¦çš„çº¿æ€§åŒ–æ–¹æ³•ï¼Œä»O(NÂ²)åˆ°O(N)çš„å¤æ‚åº¦åˆ†æã€‚",
                "key_concepts": [
                    "æ ¸æŠ€å·§ï¼šåˆ©ç”¨çŸ©é˜µä¹˜æ³•ç»“åˆå¾‹é‡æ’è®¡ç®—é¡ºåº",
                    "å¤æ‚åº¦ä¼˜åŒ–ï¼š$(QK^T)V$ vs $Q(K^TV)$",
                    "ç²¾åº¦æƒè¡¡ï¼šSoftmaxèšç„¦èƒ½åŠ› vs è®¡ç®—æ•ˆç‡",
                    "å·¥ç¨‹å®ç°ï¼šFlashAttentionçš„IO-Awareä¼˜åŒ–"
                ],
                "formula": r"\\text{æ ‡å‡†}: (QK^T)V \\quad \\text{vs} \\quad \\text{çº¿æ€§}: Q(K^TV)",
                "applications": ["é•¿åºåˆ—å¤„ç†", "é«˜åˆ†è¾¨ç‡å›¾åƒ", "å†…å­˜ä¼˜åŒ–"]
            }
        },
        "neuroevolution": {
            "es_vs_gradient": {
                "title": "ES vs æ¢¯åº¦ä¸‹é™",
                "description": "å¯¹æ¯”è¿›åŒ–ç­–ç•¥å’Œæ¢¯åº¦ä¸‹é™çš„ä¼˜åŠ£åŠ¿ï¼Œç†è§£é›¶é˜¶ä¼˜åŒ–çš„é€‚ç”¨åœºæ™¯ã€‚",
                "key_concepts": [
                    "ç™»å±±è€…vsç©ºé™å…µï¼šå±€éƒ¨ä¿¡æ¯vså…¨å±€è§†è§’",
                    "ç¾¤ä½“æœç´¢ï¼šé€šè¿‡ç§ç¾¤å¹¶è¡Œé‡‡æ ·æ¢ç´¢å‚æ•°ç©ºé—´",
                    "æ ·æœ¬æ•ˆç‡ï¼šESçš„æ ·æœ¬æ•ˆç‡ä½ä½†å…¨å±€æœç´¢èƒ½åŠ›å¼º",
                    "é€‚ç”¨åœºæ™¯ï¼šä¸å¯å¾®ã€éå‡¸ã€ç¨€ç–å¥–åŠ±é—®é¢˜"
                ],
                "formula": r"\\nabla_\\theta J(\\theta) \\approx \\frac{1}{\\sigma N} \\sum_{i=1}^N F(\\theta + \\epsilon_i) \\cdot \\epsilon_i",
                "applications": ["å¼ºåŒ–å­¦ä¹ ", "è¶…å‚æ•°ä¼˜åŒ–", "ç¥ç»æ¶æ„æœç´¢"]
            },
            "openai_es": {
                "title": "OpenAI ESç®—æ³•",
                "description": "æ·±å…¥ç†è§£OpenAI ESçš„é•œåƒé‡‡æ ·æŠ€æœ¯å’Œæ–¹å·®ä¼˜åŒ–ç­–ç•¥ã€‚",
                "key_concepts": [
                    "é•œåƒé‡‡æ ·ï¼š$R_i^+$å’Œ$R_i^-$çš„å¯¹ç§°é‡‡æ ·é™ä½æ–¹å·®",
                    "é«˜æ–¯å¹³æ»‘ï¼š$J(\\theta) = \\mathbb{E}[F(\\theta + \\epsilon)]$çš„å¹³æ»‘åŒ–",
                    "æ— åå‘ä¼ æ’­ï¼šç›´æ¥é€šè¿‡å‡½æ•°å€¼ä¼°è®¡æ¢¯åº¦æ–¹å‘",
                    "åˆ†å¸ƒå¼å‹å¥½ï¼šå¤©ç„¶é€‚åˆå¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—"
                ],
                "formula": r"\\theta_{t+1} = \\theta_t + \\alpha \\cdot \\frac{1}{n\\sigma} \\sum_{i=1}^n (R_i^+ - R_i^-) \\epsilon_i",
                "applications": ["MuJoCoæ§åˆ¶", "Atariæ¸¸æˆ", "æœºå™¨äººæ§åˆ¶"]
            },
            "pbt_training": {
                "title": "PBTç§ç¾¤è®­ç»ƒ",
                "description": "å­¦ä¹ DeepMindçš„PBTç®—æ³•ï¼Œå®ç°è¶…å‚æ•°çš„åŠ¨æ€è¿›åŒ–ã€‚",
                "key_concepts": [
                    "åŒå±‚ä¼˜åŒ–ï¼šå†…å±‚SGDä¼˜åŒ–æƒé‡ï¼Œå¤–å±‚è¿›åŒ–ä¼˜åŒ–è¶…å‚æ•°",
                    "Exploit & Exploreï¼šåˆ©ç”¨ä¼˜ç§€ä¸ªä½“ï¼Œæ¢ç´¢è¶…å‚æ•°ç©ºé—´",
                    "åŠ¨æ€é€‚åº”ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒæ•´å­¦ä¹ ç‡ã€åŠ¨é‡ç­‰",
                    "ç§ç¾¤å¤šæ ·æ€§ï¼šä¿æŒæ¢ç´¢èƒ½åŠ›é¿å…è¿‡æ—©æ”¶æ•›"
                ],
                "formula": r"\\text{å†…å±‚}: \\theta \\leftarrow \\theta - \\eta \\nabla L \\quad \\text{å¤–å±‚}: \\lambda \\leftarrow \\text{Evolve}(\\lambda)",
                "applications": ["AlphaStar", "è¶…å‚æ•°è‡ªåŠ¨è°ƒä¼˜", "é•¿æœŸè®­ç»ƒä¼˜åŒ–"]
            },
            "cma_es": {
                "title": "CMA-ESåæ–¹å·®é€‚åº”",
                "description": "æŒæ¡æœ€å¼ºå¤§çš„è¿›åŒ–ç­–ç•¥CMA-ESï¼Œç†è§£åæ–¹å·®çŸ©é˜µçš„è‡ªé€‚åº”æœºåˆ¶ã€‚",
                "key_concepts": [
                    "æ¤­çƒæ¢ç´¢ï¼šä»åœ†å½¢æ¢ç´¢åŸŸåˆ°æ¤­çƒæ¢ç´¢åŸŸçš„è¿›åŒ–",
                    "åæ–¹å·®å­¦ä¹ ï¼šè‡ªåŠ¨å­¦ä¹ å‚æ•°é—´çš„ç›¸å…³æ€§ç»“æ„",
                    "è‡ªé€‚åº”æ­¥é•¿ï¼šæ ¹æ®æˆåŠŸæ¦‚ç‡åŠ¨æ€è°ƒæ•´æ¢ç´¢å¼ºåº¦",
                    "ç‰¹å¾å€¼åˆ†æï¼šé€šè¿‡åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼ç†è§£æœç´¢æ–¹å‘"
                ],
                "formula": r"\\mathbf{x}_{t+1} \\sim \\mathcal{N}(\\mathbf{m}_t, \\sigma_t^2 \\mathbf{C}_t)",
                "applications": ["å‡½æ•°ä¼˜åŒ–", "å·¥ç¨‹å‚æ•°è°ƒä¼˜", "é«˜ç»´éå‡¸ä¼˜åŒ–"]
            }
        },
        "probabilistic_programming": {
            "bayesian_basics": {
                "title": "è´å¶æ–¯æ¨æ–­åŸºç¡€",
                "description": "ç†è§£è´å¶æ–¯å…¬å¼çš„æ•°å­¦åŸç†ï¼Œä»é¢‘ç‡æ´¾åˆ°è´å¶æ–¯æ´¾çš„ä¸–ç•Œè§‚è½¬å˜ã€‚",
                "key_concepts": [
                    "è´å¶æ–¯å…¬å¼ï¼šåéªŒ=ä¼¼ç„¶Ã—å…ˆéªŒ/è¯æ®",
                    "è¾¹ç¼˜ä¼¼ç„¶ï¼šé«˜ç»´ç§¯åˆ†çš„è®¡ç®—ç¾éš¾",
                    "ç‚¹ä¼°è®¡vsåˆ†å¸ƒæ¨æ–­ï¼šMLE vs åéªŒåˆ†å¸ƒ",
                    "å…±è½­å…ˆéªŒï¼šç®€åŒ–åéªŒè®¡ç®—çš„æ•°å­¦æŠ€å·§"
                ],
                "formula": r"p(w|D) = \\frac{p(D|w)p(w)}{p(D)} = \\frac{p(D|w)p(w)}{\\int p(D|w)p(w)dw}",
                "applications": ["å‚æ•°ä¼°è®¡", "æ¨¡å‹é€‰æ‹©", "å‡è®¾æ£€éªŒ"]
            },
            "vi_vs_mcmc": {
                "title": "å˜åˆ†æ¨æ–­ vs MCMC",
                "description": "å¯¹æ¯”ä¸¤ç§ç»•è¿‡é«˜ç»´ç§¯åˆ†çš„æ–¹æ³•ï¼šä¼˜åŒ–vsé‡‡æ ·ã€‚",
                "key_concepts": [
                    "å˜åˆ†æ¨æ–­ï¼šELBOæœ€å¤§åŒ–ï¼Œå¿«é€Ÿè¿‘ä¼¼",
                    "MCMCï¼šé©¬å°”å¯å¤«é“¾é‡‡æ ·ï¼Œç†è®ºç²¾ç¡®",
                    "KLæ•£åº¦ï¼šè¡¡é‡åˆ†å¸ƒç›¸ä¼¼åº¦çš„æ•°å­¦å·¥å…·",
                    "è®¡ç®—å¤æ‚åº¦ï¼šO(N) vs O(NÂ²)çš„æƒè¡¡"
                ],
                "formula": r"L(\\theta) = \\mathbb{E}_{w \\sim q_\\theta}[\\log P(D \\mid w)] - KL(q_{\\theta}(w) \\mid\\mid P(w))",
                "applications": ["å¤§è§„æ¨¡è´å¶æ–¯æ¨æ–­", "å®æ—¶åº”ç”¨", "ç§‘ç ”è®¡ç®—"]
            },
            "reparameterization": {
                "title": "é‡å‚æ•°åŒ–æŠ€å·§",
                "description": "æŒæ¡è®©æ¢¯åº¦æµè¿‡éšæœºå±‚çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œç†è§£VAEå’Œè´å¶æ–¯ç¥ç»ç½‘ç»œçš„åŸºç¡€ã€‚",
                "key_concepts": [
                    "æ¢¯åº¦æµåŠ¨ï¼šä»éšæœºé‡‡æ ·åˆ°ç¡®å®šæ€§å˜æ¢",
                    "æ ‡å‡†å™ªå£°ï¼š$\\epsilon \\sim \\mathcal{N}(0,1)$çš„å¼•å…¥",
                    "è®¡ç®—å›¾è¿ç»­æ€§ï¼šåå‘ä¼ æ’­çš„æ•°å­¦ä¿è¯",
                    "è’™ç‰¹å¡æ´›æ¢¯åº¦ï¼šæ— åä¼°è®¡çš„ç»Ÿè®¡å­¦åŸç†"
                ],
                "formula": r"z = \\mu + \\sigma \\odot \\epsilon, \\quad \\epsilon \\sim \\mathcal{N}(0, 1)",
                "applications": ["VAE", "è´å¶æ–¯ç¥ç»ç½‘ç»œ", "ç”Ÿæˆæ¨¡å‹", "å¼ºåŒ–å­¦ä¹ "]
            },
            "uncertainty_analysis": {
                "title": "ä¸ç¡®å®šæ€§åˆ†æ",
                "description": "åŒºåˆ†è®¤çŸ¥ä¸ç¡®å®šæ€§å’Œä»»æ„ä¸ç¡®å®šæ€§ï¼Œç†è§£AIç³»ç»Ÿå®‰å…¨æ€§çš„æ•°å­¦åŸºç¡€ã€‚",
                "key_concepts": [
                    "è®¤çŸ¥ä¸ç¡®å®šæ€§ï¼šçŸ¥è¯†ç›²åŒºï¼Œå¯é€šè¿‡æ•°æ®æ¶ˆé™¤",
                    "ä»»æ„ä¸ç¡®å®šæ€§ï¼šæ•°æ®å›ºæœ‰å™ªå£°ï¼Œæ— æ³•æ¶ˆé™¤",
                    "ä¸ç¡®å®šæ€§åˆ†è§£ï¼šæ€»æ–¹å·®=è®¤çŸ¥æ–¹å·®+ä»»æ„æ–¹å·®",
                    "å®‰å…¨å…³é”®åº”ç”¨ï¼šè‡ªåŠ¨é©¾é©¶ã€åŒ»ç–—è¯Šæ–­çš„é£é™©è¯„ä¼°"
                ],
                "formula": r"\\text{Var}_{total} = \\text{Var}_{epistemic} + \\text{Var}_{aleatoric}",
                "applications": ["è‡ªåŠ¨é©¾é©¶", "åŒ»ç–—è¯Šæ–­", "é‡‘èé£æ§", "ç§‘å­¦å‘ç°"]
            }
        },
        "mdp": {
            "mdp_basics": {
                "title": "MDPåŸºç¡€æ¦‚å¿µ",
                "description": "ç†è§£é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹çš„äº”å…ƒç»„å®šä¹‰å’Œä¸–ç•Œè§‚å»ºæ¨¡ã€‚",
                "key_concepts": [
                    "äº”å…ƒç»„å®šä¹‰ï¼šM = âŸ¨S, A, P, R, Î³âŸ©",
                    "é©¬å°”å¯å¤«æ€§è´¨ï¼šæœªæ¥åªå–å†³äºç°åœ¨",
                    "æŠ˜æ‰£å› å­ï¼šÎ³çš„å“²å­¦å«ä¹‰å’Œæ•°å­¦ä½œç”¨",
                    "çŠ¶æ€è½¬ç§»æ¦‚ç‡ï¼šç‰©ç†è§„å¾‹çš„æ•°å­¦æè¿°"
                ],
                "formula": r"M = \\langle S, A, P, R, \\gamma \\rangle",
                "applications": ["å¼ºåŒ–å­¦ä¹ åŸºç¡€", "å†³ç­–ç†è®º", "åºåˆ—å†³ç­–"]
            },
            "value_iteration": {
                "title": "ä»·å€¼è¿­ä»£ç®—æ³•",
                "description": "è´å°”æ›¼æ–¹ç¨‹çš„æ•°å€¼æ±‚è§£å’Œå·´æ‹¿èµ«ä¸åŠ¨ç‚¹å®šç†ä¿è¯ã€‚",
                "key_concepts": [
                    "è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼šä»·å€¼å‡½æ•°çš„é€’å½’å®šä¹‰",
                    "è´å°”æ›¼æœ€ä¼˜æ–¹ç¨‹ï¼šæœ€ä¼˜ç­–ç•¥çš„å……è¦æ¡ä»¶",
                    "å‹ç¼©æ˜ å°„ï¼šÎ³ < 1æ—¶çš„æ”¶æ•›ä¿è¯",
                    "åŠ¨æ€è§„åˆ’ï¼šè¡¨æ ¼å‹æ–¹æ³•çš„å®ç°"
                ],
                "formula": r"V_{k+1}(s) = \\max_{a} \\sum_{s'} P(s' \\mid s, a) [R(s, a, s') + \\gamma V_k(s')]",
                "applications": ["ç½‘æ ¼ä¸–ç•Œ", "è·¯å¾„è§„åˆ’", "èµ„æºåˆ†é…"]
            },
            "q_learning": {
                "title": "Q-Learningç®—æ³•",
                "description": "æ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ çš„ç»å…¸æ–¹æ³•ï¼Œæ—¶åºå·®åˆ†å­¦ä¹ çš„æ ¸å¿ƒã€‚",
                "key_concepts": [
                    "åŠ¨ä½œä»·å€¼å‡½æ•°ï¼šQ(s,a)çš„æ•°å­¦å®šä¹‰",
                    "æ—¶åºå·®åˆ†ï¼šTDè¯¯å·®çš„è®¡ç®—å’Œæ›´æ–°",
                    "Îµ-è´ªå©ªç­–ç•¥ï¼šæ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡",
                    "æ”¶æ•›æ€§ï¼šæ— æ¨¡å‹æ–¹æ³•çš„æ•°å­¦ä¿è¯"
                ],
                "formula": r"Q(s,a) \\leftarrow Q(s,a) + \\alpha [R + \\gamma \\max_{a'} Q(s',a') - Q(s,a)]",
                "applications": ["æ¸¸æˆAI", "æœºå™¨äººæ§åˆ¶", "æ¨èç³»ç»Ÿ"]
            },
            "policy_gradient": {
                "title": "ç­–ç•¥æ¢¯åº¦æ–¹æ³•",
                "description": "ç›´æ¥ä¼˜åŒ–ç­–ç•¥å‚æ•°çš„æ–¹æ³•ï¼Œé€‚ç”¨äºè¿ç»­åŠ¨ä½œç©ºé—´ã€‚",
                "key_concepts": [
                    "å¯¹æ•°å¯¼æ•°æŠ€å·§ï¼šREINFORCEç®—æ³•æ¨å¯¼",
                    "ç­–ç•¥å‚æ•°åŒ–ï¼šSoftmaxå’Œç¥ç»ç½‘ç»œç­–ç•¥",
                    "é‡è¦æ€§é‡‡æ ·ï¼šæé«˜æ ·æœ¬æ•ˆç‡",
                    "æ¼”å‘˜-è¯„è®ºå®¶ï¼šç»“åˆä»·å€¼å‡½æ•°çš„æ–¹æ³•"
                ],
                "formula": r"\\nabla_{\\theta} J(\\theta) = \\mathbb{E}[\\sum_{t} \\nabla_{\\theta} \\log \\pi_{\\theta}(a_t \\mid s_t) \\cdot G_t]",
                "applications": ["è¿ç»­æ§åˆ¶", "æœºå™¨äººè¿åŠ¨", "æ¸¸æˆç­–ç•¥"]
            }
        },
        "information_geometry": {
            "parameter_vs_probability": {
                "title": "å‚æ•°ç©ºé—´vsæ¦‚ç‡ç©ºé—´",
                "description": "ç†è§£ä¸ºä»€ä¹ˆå‚æ•°è·ç¦»ä¸ç­‰äºæ¦‚ç‡è·ç¦»ï¼Œå»ºç«‹å‡ ä½•ç›´è§‰ã€‚",
                "key_concepts": [
                    "è·ç¦»åº¦é‡ï¼šæ¬§æ°è·ç¦»vs KLæ•£åº¦",
                    "åˆ†å¸ƒæ•æ„Ÿæ€§ï¼šæ–¹å·®å¯¹å‚æ•°å˜åŒ–çš„å½±å“",
                    "é‡å åº¦è®¡ç®—ï¼šä¸¤ä¸ªåˆ†å¸ƒçš„ç›¸ä¼¼æ€§åº¦é‡",
                    "å‡ ä½•ç›´è§‚ï¼šæ¦‚ç‡æµå½¢çš„å¯è§†åŒ–"
                ],
                "formula": r"D_{KL}(p_\\theta \\| p_{\\theta+\\delta}) \\approx \\frac{1}{2} \\delta^T \\mathbf{F}(\\theta) \\delta",
                "applications": ["æ¨¡å‹æ¯”è¾ƒ", "åˆ†å¸ƒå­¦ä¹ ", "å˜åˆ†æ¨æ–­"]
            },
            "fisher_information": {
                "title": "è´¹é›ªä¿¡æ¯çŸ©é˜µ",
                "description": "è¿æ¥æ¦‚ç‡ç»Ÿè®¡ä¸å¾®åˆ†å‡ ä½•çš„æ¡¥æ¢ï¼Œå®šä¹‰æ¦‚ç‡æµå½¢çš„åº¦é‡ã€‚",
                "key_concepts": [
                    "FIMå®šä¹‰ï¼šå¯¹æ•°ä¼¼ç„¶æ¢¯åº¦çš„åæ–¹å·®",
                    "å‡ ä½•æ„ä¹‰ï¼šå±€éƒ¨æ›²ç‡å’Œæ•æ„Ÿåº¦",
                    "ç‰¹å¾åˆ†è§£ï¼šä¸»æ–¹å‘å’Œæ¡ä»¶æ•°åˆ†æ",
                    "è®¡ç®—æ–¹æ³•ï¼šè§£æè§£vsæ•°å€¼ä¼°è®¡"
                ],
                "formula": r"\\mathbf{F} = \\mathbb{E}[\\nabla_\\theta \\log p(x|\\theta) \\nabla_\\theta \\log p(x|\\theta)^T]",
                "applications": ["ç»Ÿè®¡æ¨æ–­", "ä¿¡æ¯å‡ ä½•", "è‡ªç„¶æ¢¯åº¦"]
            },
            "natural_gradient": {
                "title": "è‡ªç„¶æ¢¯åº¦ä¸‹é™",
                "description": "åœ¨é»æ›¼æµå½¢ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œè€ƒè™‘æ¦‚ç‡åˆ†å¸ƒçš„å‡ ä½•ç»“æ„ã€‚",
                "key_concepts": [
                    "çº¦æŸä¼˜åŒ–ï¼šå›ºå®šKLæ•£åº¦çš„æ­¥é•¿é€‰æ‹©",
                    "é¢„å¤„ç†æœºåˆ¶ï¼šFIMé€†çš„ä½œç”¨",
                    "æµ‹åœ°çº¿ï¼šæµå½¢ä¸Šçš„æœ€çŸ­è·¯å¾„",
                    "æ•°å€¼ç¨³å®šæ€§ï¼šé¿å…æ¢¯åº¦çˆ†ç‚¸"
                ],
                "formula": r"\\theta_{t+1} = \\theta_t - \\eta \\mathbf{F}^{-1} \\nabla L(\\theta_t)",
                "applications": ["ç¥ç»ç½‘ç»œè®­ç»ƒ", "ç»Ÿè®¡å­¦ä¹ ", "ä¼˜åŒ–ç®—æ³•"]
            },
            "adam_geometry": {
                "title": "Adamçš„å‡ ä½•è§£é‡Š",
                "description": "ç†è§£Adamä½œä¸ºè‡ªç„¶æ¢¯åº¦å¯¹è§’è¿‘ä¼¼çš„å‡ ä½•æ„ä¹‰ã€‚",
                "key_concepts": [
                    "å¯¹è§’è¿‘ä¼¼ï¼šå¿½ç•¥å‚æ•°é—´ç›¸å…³æ€§",
                    "äºŒé˜¶çŸ©ä¼°è®¡ï¼šv_tä¸FIMçš„å…³ç³»",
                    "è‡ªé€‚åº”æ­¥é•¿ï¼šæ¯ä¸ªç»´åº¦çš„ç‹¬ç«‹ç¼©æ”¾",
                    "å®è·µæ•ˆæœï¼šè®¡ç®—æ•ˆç‡vsç†è®ºæœ€ä¼˜"
                ],
                "formula": r"\\Delta \\theta \\propto -\\frac{1}{\\sqrt{v_t}} \\nabla L \\approx -\\frac{1}{\\sqrt{\\text{diag}(\\mathbf{F})}} \\nabla L",
                "applications": ["æ·±åº¦å­¦ä¹ ", "å¤§è§„æ¨¡ä¼˜åŒ–", "è‡ªé€‚åº”å­¦ä¹ ç‡"]
            }
        }
    }
    
    # è·å–åŸºç¡€æè¿°
    if module_key in base_descriptions and scene_name in base_descriptions[module_key]:
        return base_descriptions[module_key][scene_name]
    else:
        return {
            "title": scene_name.replace("_", " ").title(),
            "description": "è¿™æ˜¯ä¸€ä¸ªæ•°å­¦å¯è§†åŒ–åœºæ™¯ï¼Œå¸®åŠ©ç†è§£ç›¸å…³æ¦‚å¿µã€‚",
            "key_concepts": ["æ¦‚å¿µ1", "æ¦‚å¿µ2", "æ¦‚å¿µ3"],
            "formula": "ç›¸å…³æ•°å­¦å…¬å¼",
            "advantages": ["ä¼˜ç‚¹1", "ä¼˜ç‚¹2"],
            "disadvantages": ["ç¼ºç‚¹1", "ç¼ºç‚¹2"]
        }

# è‡ªå®šä¹‰CSSæ ·å¼
st.markdown(f"""
<style>
    /* å…¨å±€æ ·å¼ */
    .stApp {{
        background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
        color: #ffffff;
    }}
    
    /* ä¸»æ ‡é¢˜æ ·å¼ */
    .main-header {{
        text-align: center;
        color: {COLORS["primary"]};
        padding: 2rem 0;
        font-size: 3rem;
        font-weight: bold;
        text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        margin-bottom: 1rem;
    }}
    
    /* æ¨¡å—å¡ç‰‡æ ·å¼ */
    .module-card {{
        border: none;
        border-radius: 15px;
        padding: 2rem;
        margin: 1.5rem 0;
        background: linear-gradient(135deg, rgba(26, 26, 46, 0.9) 0%, rgba(15, 20, 25, 0.9) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        border: 1px solid rgba(59, 130, 246, 0.2);
    }}
    
    .module-card:hover {{
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        border-color: {COLORS["accent"]};
    }}
    
    /* åœºæ™¯æŒ‰é’®æ ·å¼ */
    .scene-button {{
        background: linear-gradient(135deg, {COLORS["primary"]} 0%, {COLORS["secondary"]} 100%);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        margin: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 1rem;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        position: relative;
        overflow: hidden;
    }}
    
    .scene-button:before {{
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }}
    
    .scene-button:hover {{
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
    }}
    
    .scene-button:hover:before {{
        left: 100%;
    }}
    
    /* è§†é¢‘å®¹å™¨æ ·å¼ */
    .video-container {{
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        margin: 1rem 0;
        background: #000;
        position: relative;
    }}
    
    .video-container:after {{
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 2px solid rgba(59, 130, 246, 0.3);
        border-radius: 15px;
        pointer-events: none;
    }}
    
    /* æ¦‚å¿µæ ‡ç­¾æ ·å¼ */
    .concept-tag {{
        background: linear-gradient(135deg, {COLORS["secondary"]} 0%, {COLORS["accent"]} 100%);
        color: white;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
        margin: 0.3rem;
        display: inline-block;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        transition: all 0.2s ease;
    }}
    
    .concept-tag:hover {{
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5);
    }}
    
    /* åˆ†æå¡ç‰‡æ ·å¼ */
    .analysis-card {{
        border: none;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        background: linear-gradient(135deg, rgba(15, 20, 25, 0.9) 0%, rgba(26, 26, 46, 0.9) 100%);
        backdrop-filter: blur(5px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.1);
        transition: all 0.3s ease;
    }}
    
    .analysis-card:hover {{
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(59, 130, 246, 0.3);
    }}
    
    .analysis-title {{
        color: {COLORS["accent"]};
        font-weight: bold;
        margin-bottom: 1rem;
        font-size: 1.2rem;
        border-bottom: 2px solid {COLORS["accent"]};
        padding-bottom: 0.5rem;
    }}
    
    /* ç« èŠ‚æ ‡é¢˜æ ·å¼ */
    .section-header {{
        color: {COLORS["primary"]};
        font-size: 1.8rem;
        font-weight: bold;
        margin: 2rem 0 1rem 0;
        text-align: center;
        position: relative;
        padding-bottom: 0.5rem;
    }}
    
    .section-header:after {{
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 3px;
        background: linear-gradient(90deg, {COLORS["primary"]}, {COLORS["accent"]});
        border-radius: 2px;
    }}
    
    /* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
    .stat-card {{
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        backdrop-filter: blur(5px);
        transition: all 0.3s ease;
    }}
    
    .stat-card:hover {{
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
    }}
    
    /* è¿›åº¦æ¡æ ·å¼ */
    .progress-indicator {{
        background-color: rgba(71, 85, 105, 0.3);
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
        margin: 1rem 0;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }}
    
    .progress-bar {{
        background: linear-gradient(90deg, {COLORS["primary"]}, {COLORS["accent"]});
        height: 100%;
        transition: width 0.5s ease;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }}
    
    /* åˆ—è¡¨é¡¹æ ·å¼ */
    .list-item {{
        margin: 0.5rem 0;
        padding: 0.5rem;
        border-left: 3px solid {COLORS["primary"]};
        background: rgba(59, 130, 246, 0.05);
        border-radius: 0 8px 8px 0;
        transition: all 0.2s ease;
    }}
    
    .list-item:hover {{
        background: rgba(59, 130, 246, 0.1);
        transform: translateX(5px);
    }}
    
    /* ä¾§è¾¹æ æ ·å¼ */
    .css-1d391kg {{
        background: linear-gradient(135deg, rgba(15, 20, 25, 0.95) 0%, rgba(26, 26, 46, 0.95) 100%);
        backdrop-filter: blur(10px);
    }}
    
    /* æŒ‰é’®ç»„æ ·å¼ */
    .button-group {{
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        margin: 1rem 0;
    }}
</style>
""", unsafe_allow_html=True)

def main():
    # ä¸»æ ‡é¢˜
    st.markdown('<h1 class="main-header">ğŸ§® æ•°å­¦ç¬”è®°å¯è§†åŒ–å¹³å°</h1>', unsafe_allow_html=True)
    
    # æ¬¢è¿åŒºåŸŸ
    st.markdown("""
    <div style='text-align: center; margin: 2rem 0; padding: 2rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); border-radius: 20px; border: 1px solid rgba(59, 130, 246, 0.2);'>
        <h2 style='color: #ffffff; margin-bottom: 1rem;'>ğŸŒŸ æ¬¢è¿æ¥åˆ°æ•°å­¦å¯è§†åŒ–ä¸–ç•Œ</h2>
        <p style='color: #b0b0b0; font-size: 1.1rem; line-height: 1.6;'>
            è¿™ä¸ªå¹³å°å°†å¤æ‚çš„æ•°å­¦æ¦‚å¿µé€šè¿‡ Manim åŠ¨ç”»å’Œäº¤äº’å¼å¯è§†åŒ–å˜å¾—ç”ŸåŠ¨æœ‰è¶£ã€‚<br>
            æ¯ä¸ªæ¨¡å—éƒ½åŒ…å«ç²¾å¿ƒè®¾è®¡çš„åŠ¨ç”»åœºæ™¯ï¼Œå¸®åŠ©ä½ æ·±å…¥ç†è§£æ•°å­¦åŸç†ã€‚
        </p>
    </div>
    """, unsafe_allow_html=True)
    
    # ä¾§è¾¹æ å¯¼èˆª
    st.sidebar.markdown("""
    <div style='text-align: center; padding: 1rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border-radius: 15px; margin-bottom: 1rem;'>
        <h3 style='color: #ffffff; margin: 0;'>ğŸ“š å¯¼èˆª</h3>
    </div>
    """, unsafe_allow_html=True)
    
    # å¯¼èˆªæ¨¡å¼é€‰æ‹©
    nav_mode = st.sidebar.radio(
        "é€‰æ‹©å¯¼èˆªæ–¹å¼",
        ["ğŸ“– æ¨¡å—æµè§ˆ", "ğŸ“ å­¦ä¹ è·¯å¾„", "ğŸ•¸ï¸ æ¦‚å¿µåœ°å›¾"],
        help="é€‰æ‹©ä½ å–œæ¬¢çš„æµè§ˆæ–¹å¼",
        key="nav_mode"
    )
    
    st.sidebar.markdown("---")
    
    # æ ¹æ®å¯¼èˆªæ¨¡å¼æ˜¾ç¤ºä¸åŒå†…å®¹
    if nav_mode == "ğŸ“ å­¦ä¹ è·¯å¾„":
        render_learning_paths()
        return
    elif nav_mode == "ğŸ•¸ï¸ æ¦‚å¿µåœ°å›¾":
        show_concept_map()
        st.markdown("---")
        st.info("ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¾§è¾¹æ çš„'ğŸ“– æ¨¡å—æµè§ˆ'å¯ä»¥å¼€å§‹å­¦ä¹ å…·ä½“æ¨¡å—")
        return
    
    # æ¨¡å—é€‰æ‹© - æŒ‰ç…§å­¦ä¹ éš¾æ˜“ç¨‹åº¦æ’åº
    from learning_paths import RECOMMENDED_ORDER, get_difficulty_score
    
    # æŒ‰ç…§æ¨èé¡ºåºæ’åºæ¨¡å—
    sorted_module_keys = [m for m in RECOMMENDED_ORDER if m in MODULES.keys()]
    
    # æ·»åŠ ä»»ä½•ä¸åœ¨æ¨èåˆ—è¡¨ä¸­çš„æ¨¡å—ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
    for key in MODULES.keys():
        if key not in sorted_module_keys:
            sorted_module_keys.append(key)
    
    selected_module = st.sidebar.selectbox(
        "é€‰æ‹©ä¸€ä¸ªæ•°å­¦æ¨¡å—ï¼ˆæŒ‰éš¾åº¦æ’åºï¼‰ï¼š",
        options=sorted_module_keys,
        format_func=lambda x: f"{'â­' * get_difficulty_score(x)} {MODULES[x]['name']}",
        key="module_selector",
        help="æ¨¡å—æŒ‰ç…§ä»æ˜“åˆ°éš¾çš„é¡ºåºæ’åˆ—ï¼Œâ­è¶Šå¤šéš¾åº¦è¶Šé«˜"
    )
    
    # æ¨¡å—é¢„è§ˆä¿¡æ¯
    if selected_module:
        module = MODULES[selected_module]
        st.sidebar.markdown(f"""
        <div style='padding: 1rem; background: rgba(26, 26, 46, 0.8); border-radius: 10px; margin: 1rem 0; border: 1px solid rgba(59, 130, 246, 0.2);'>
            <h4 style='color: {module["color"]}; margin: 0 0 0.5rem 0;'>{module["name"]}</h4>
            <p style='color: #b0b0b0; font-size: 0.9rem; margin: 0;'>{module["description"]}</p>
            <p style='color: #888; font-size: 0.8rem; margin: 0.5rem 0 0 0;'>ğŸ“ {module["file"]}</p>
        </div>
        """, unsafe_allow_html=True)
    
    # æ˜¾ç¤ºé€‰ä¸­æ¨¡å—çš„ä¿¡æ¯
    display_module_info(selected_module)
    
    # åº•éƒ¨ä¿¡æ¯
    st.markdown("---")
    st.markdown("""
    <div style='text-align: center; padding: 2rem; background: rgba(15, 20, 25, 0.5); border-radius: 15px; margin-top: 2rem;'>
        <p style='color: #888; margin: 0;'>ğŸš€ åŸºäº Manim & Streamlit æ„å»º | ğŸ“– æ•°å­¦ç¬”è®°å¯è§†åŒ–é¡¹ç›®</p>
    </div>
    """, unsafe_allow_html=True)

def display_module_info(module_key):
    """æ˜¾ç¤ºæ¨¡å—ä¿¡æ¯å’Œå†…å®¹"""
    module = MODULES[module_key]
    
    # æ˜¾ç¤ºå­¦ä¹ è¿›åº¦å’Œæ¨èï¼ˆåœ¨ä¾§è¾¹æ ï¼‰
    show_learning_progress(current_module_key=module_key)
    
    # æ¨¡å—æ ‡é¢˜å¡ç‰‡
    st.markdown(f"""
    <div class="module-card">
        <div style='display: flex; align-items: center; margin-bottom: 1rem;'>
            <div style='width: 80px; height: 80px; background: linear-gradient(135deg, {module["color"]}, {COLORS["accent"]}); 
                        border-radius: 20px; margin-right: 1.5rem; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);'></div>
            <div>
                <h2 style='color: {module["color"]}; margin: 0; font-size: 2rem;'>{module["name"]}</h2>
                <p style='color: #b0b0b0; margin: 0.5rem 0; font-size: 1.1rem;'>{module["description"]}</p>
                <p style='color: #888; margin: 0; font-size: 0.9rem;'>ğŸ“ {module["file"]}</p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # å®šä¹‰æœ‰Manimè§†é¢‘çš„æ¨¡å—
    modules_with_video = ["matrix", "convolution", "loss", "optimizer", "svm"]
    
    # å¯è§†åŒ–æ¨¡å¼é€‰æ‹©
    st.markdown('<h2 class="section-header">ğŸ¬ å¯è§†åŒ–æ¨¡å¼</h2>', unsafe_allow_html=True)
    
    if module_key in modules_with_video:
        # æœ‰è§†é¢‘çš„æ¨¡å—ï¼šæä¾›æ¨¡å¼é€‰æ‹©
        viz_mode = st.radio(
            "é€‰æ‹©å¯è§†åŒ–æ–¹å¼ï¼š",
            ["ğŸ“¹ è§†é¢‘åŠ¨ç”» (Manimæ¸²æŸ“)", "ğŸ® å®æ—¶äº¤äº’ (Streamlitäº¤äº’)"],
            horizontal=True,
            help="è§†é¢‘åŠ¨ç”»ï¼šé«˜è´¨é‡é¢„æ¸²æŸ“åŠ¨ç”» | å®æ—¶äº¤äº’ï¼šå¯è°ƒå‚æ•°ã€å³æ—¶åé¦ˆ"
        )
        
        if "å®æ—¶äº¤äº’" in viz_mode:
            # æ˜¾ç¤ºäº¤äº’å¼å¯è§†åŒ–
            display_interactive_content(module_key)
            return
    else:
        # æ²¡æœ‰è§†é¢‘çš„æ¨¡å—ï¼šç›´æ¥æ˜¾ç¤ºäº¤äº’å¼ï¼Œå¹¶ç»™å‡ºæç¤º
        st.markdown(f"""
        <div style='padding: 1rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); 
                   border-radius: 15px; border: 1px solid rgba(59, 130, 246, 0.2); margin-bottom: 2rem;'>
            <h3 style='color: {module["color"]}; margin: 0 0 0.5rem 0;'>ğŸ® äº¤äº’å¼å¯è§†åŒ–æ¨¡å¼</h3>
            <p style='color: #b0b0b0; margin: 0;'>
                {module['name']} æ¨¡å—ä¸“æ³¨äºå®æ—¶äº¤äº’ä½“éªŒï¼Œä½ å¯ä»¥è°ƒæ•´å‚æ•°ï¼Œè§‚å¯Ÿç®—æ³•çš„åŠ¨æ€å˜åŒ–è¿‡ç¨‹ã€‚
            </p>
        </div>
        """, unsafe_allow_html=True)
        
        # ç›´æ¥æ˜¾ç¤ºäº¤äº’å¼å†…å®¹
        display_interactive_content(module_key)
        return
    
    # åœºæ™¯é€‰æ‹©å’Œæ’­æ”¾ï¼ˆåŸæœ‰çš„è§†é¢‘æ¨¡å¼ï¼‰
    st.markdown('<h3 class="section-header">ğŸ“º åœºæ™¯é€‰æ‹©</h3>', unsafe_allow_html=True)
    
    # åœºæ™¯ä¸‹æ‹‰é€‰æ‹©å™¨
    scene_options = {scene: scene.replace("_", " ").title() for scene in module["scenes"]}
    
    # æ£€æŸ¥æ˜¯å¦æœ‰queryå‚æ•°æŒ‡å®šçš„åœºæ™¯
    query_scene = st.query_params.get("scene", None)
    default_index = 0
    if query_scene and query_scene in scene_options:
        default_index = list(scene_options.keys()).index(query_scene)
    
    selected_scene = st.selectbox(
        f"é€‰æ‹© {module['name']} ä¸­çš„åœºæ™¯ï¼š",
        options=list(scene_options.keys()),
        format_func=lambda x: scene_options[x],
        key=f"scene_selector_{module_key}",
        index=default_index
    )
    
    # æ˜¾ç¤ºé€‰ä¸­åœºæ™¯çš„å†…å®¹
    if selected_scene:
        st.markdown(f"""
        <div style='background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); 
                   padding: 1rem; border-radius: 15px; margin-bottom: 1.5rem; border: 1px solid rgba(59, 130, 246, 0.2);'>
            <h3 style='color: {module["color"]}; margin: 0; text-align: center; font-size: 1.5rem;'>
                ğŸ¥ {scene_options[selected_scene]}
            </h3>
        </div>
        """, unsafe_allow_html=True)
        
        # ç›´æ¥æ˜¾ç¤ºåœºæ™¯å†…å®¹ï¼ˆè§†é¢‘å’Œè§£æï¼‰
        display_scene_content(module_key, selected_scene)
    
    # å¿«é€Ÿè®¿é—®æŒ‰é’®ï¼ˆä¿ç•™åŸæœ‰çš„æŒ‰é’®æ–¹å¼ä½œä¸ºå¤‡é€‰ï¼‰
    with st.expander("ğŸ”§ å¿«é€Ÿè®¿é—®æ‰€æœ‰åœºæ™¯", expanded=False):
        st.markdown('<div class="button-group">', unsafe_allow_html=True)
        scene_cols = min(3, len(module["scenes"]))  # æœ€å¤š3åˆ—
        cols = st.columns(scene_cols)
        
        for i, scene in enumerate(module["scenes"]):
            col_idx = i % scene_cols
            with cols[col_idx]:
                scene_name = scene.replace("_", " ").title()
                if st.button(f"â–¶ï¸ {scene_name}", key=f"quick_{module_key}_{scene}", use_container_width=True):
                    # ä½¿ç”¨queryå‚æ•°æ¥åˆ‡æ¢åœºæ™¯ï¼Œé¿å…session_stateå†²çª
                    st.query_params["scene"] = scene
                    st.rerun()
        st.markdown('</div>', unsafe_allow_html=True)
    
    # æ¨¡å—ç»Ÿè®¡ä¿¡æ¯
    st.markdown('<h2 class="section-header">ğŸ“Š æ¨¡å—ç»Ÿè®¡</h2>', unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns(3)
    
    with col1:
        video_count = len(list(ASSETS_DIR.glob(f"{module_key}/*.mp4")))
        st.markdown(f"""
        <div class="stat-card">
            <h3 style='color: {COLORS["primary"]}; margin: 0; font-size: 2rem;'>{len(module["scenes"])}</h3>
            <p style='color: #b0b0b0; margin: 0.5rem 0 0 0;'>åœºæ™¯æ•°é‡</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        video_count = len(list(ASSETS_DIR.glob(f"{module_key}/*.mp4")))
        st.markdown(f"""
        <div class="stat-card">
            <h3 style='color: {COLORS["accent"]}; margin: 0; font-size: 2rem;'>{video_count}</h3>
            <p style='color: #b0b0b0; margin: 0.5rem 0 0 0;'>å·²ç”Ÿæˆè§†é¢‘</p>
        </div>
        """, unsafe_allow_html=True)
    
    with col3:
        st.markdown(f"""
        <div class="stat-card">
            <div style='width: 60px; height: 60px; background: linear-gradient(135deg, {module["color"]}, {COLORS["accent"]}); 
                        border-radius: 15px; margin: 0 auto 0.5rem auto; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);'></div>
            <p style='color: #b0b0b0; margin: 0;'>ä¸»é¢˜è‰²å½©</p>
        </div>
        """, unsafe_allow_html=True)

def display_interactive_content(module_key):
    """æ˜¾ç¤ºäº¤äº’å¼å¯è§†åŒ–å†…å®¹"""
    module = MODULES[module_key]
    
    st.markdown(f"""
    <div style='padding: 1.5rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); 
                border-radius: 15px; border: 1px solid rgba(59, 130, 246, 0.2); margin-bottom: 2rem;'>
        <h3 style='color: {module["color"]}; margin: 0 0 0.5rem 0;'>ğŸ® å®æ—¶äº¤äº’æ¨¡å¼</h3>
        <p style='color: #b0b0b0; margin: 0;'>
            åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥å®æ—¶è°ƒæ•´å‚æ•°ï¼Œè§‚å¯Ÿç®—æ³•çš„å˜åŒ–è¿‡ç¨‹ã€‚æ‰€æœ‰è®¡ç®—éƒ½æ˜¯å³æ—¶çš„ï¼Œæ— éœ€ç­‰å¾…è§†é¢‘æ¸²æŸ“ã€‚
        </p>
    </div>
    """, unsafe_allow_html=True)
    
    # æ£€æŸ¥è¯¥æ¨¡å—æ˜¯å¦æœ‰äº¤äº’å¼ç»„ä»¶
    if module_key in INTERACTIVE_MODULES:
        interactive_scenes = INTERACTIVE_MODULES[module_key]
        
        # é€‰æ‹©äº¤äº’å¼åœºæ™¯
        st.markdown("### ğŸ“Š é€‰æ‹©äº¤äº’å¼åœºæ™¯")
        scene_key = st.selectbox(
            "å¯ç”¨çš„äº¤äº’å¼åœºæ™¯ï¼š",
            options=list(interactive_scenes.keys()),
            format_func=lambda x: x.replace("_", " ").title(),
            key=f"interactive_scene_{module_key}"
        )
        
        st.markdown("---")
        
        # æ¸²æŸ“é€‰ä¸­çš„äº¤äº’å¼ç»„ä»¶
        if scene_key in interactive_scenes:
            interactive_class = interactive_scenes[scene_key]
            interactive_class.render()
    else:
        # è¯¥æ¨¡å—æš‚æ— äº¤äº’å¼ç»„ä»¶
        st.info(f"""
        ğŸš§ **{module['name']}** æ¨¡å—çš„äº¤äº’å¼å¯è§†åŒ–æ­£åœ¨å¼€å‘ä¸­ï¼
        
        ç›®å‰æ”¯æŒäº¤äº’å¼å¯è§†åŒ–çš„æ¨¡å—ï¼š
        - ğŸ“Š Loss Function (æŸå¤±å‡½æ•°)
        - ğŸ”² Convolution (å·ç§¯)
        
        æ•¬è¯·æœŸå¾…æ›´å¤šäº¤äº’å¼å†…å®¹...
        """)
        
        st.markdown("### ğŸ’¡ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº¤äº’å¼å¯è§†åŒ–ï¼Ÿ")
        col1, col2 = st.columns(2)
        
        with col1:
            st.markdown("""
            **ä¼˜ç‚¹ï¼š**
            - âš¡ å®æ—¶åé¦ˆï¼Œç§’çº§å“åº”
            - ğŸ›ï¸ å¯è°ƒå‚æ•°ï¼Œæ¢ç´¢ä¸åŒåœºæ™¯
            - ğŸ“ˆ å¤šè§†è§’å±•ç¤º
            - ğŸ¯ æ›´å¥½çš„å­¦ä¹ ä½“éªŒ
            """)
        
        with col2:
            st.markdown("""
            **é€‚ç”¨åœºæ™¯ï¼š**
            - ğŸ”¬ å‚æ•°è°ƒä¼˜å®éªŒ
            - ğŸ“š æ•™å­¦æ¼”ç¤º
            - ğŸ§ª ç®—æ³•æ¢ç´¢
            - ğŸ’¡ ç›´è§‚ç†è§£åŸç†
            """)

def display_scene_content(module_key, scene_name):
    """æ˜¾ç¤ºåœºæ™¯å†…å®¹ï¼ˆè§†é¢‘å’Œè§£æï¼‰"""
    # è·å–åœºæ™¯æè¿°
    scene_desc = get_scene_description(module_key, scene_name)
    module = MODULES[module_key]
    
    # åˆ›å»ºä¸¤åˆ—å¸ƒå±€ï¼šå·¦è¾¹è§†é¢‘ï¼Œå³è¾¹æ–‡å­—è§£æ
    col_video, col_analysis = st.columns([3, 2])
    
    with col_video:
        # è¿›åº¦æŒ‡ç¤ºå™¨
        progress_bar = st.progress(0)
        status_text = st.empty()
        
        try:
            # æ£€æŸ¥è§†é¢‘æ˜¯å¦å·²å­˜åœ¨
            scene_class, file_name = scene_mappings[module_key][scene_name]
            video_file = ASSETS_DIR / module_key / f"{scene_class}.mp4"
            
            if video_file.exists():
                st.markdown(f"""
                <div class="video-container">
                    <div style='padding: 1rem; background: rgba(0, 0, 0, 0.5); border-radius: 15px 15px 0 0;'>
                        <p style='color: #22c55e; margin: 0; text-align: center; font-weight: bold;'>âœ… è§†é¢‘å·²æ‰¾åˆ°ï¼Œæ­£åœ¨æ’­æ”¾...</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                progress_bar.progress(100)
                
                # æ’­æ”¾è§†é¢‘
                st.video(str(video_file))
            else:
                # ç”Ÿæˆè§†é¢‘
                st.markdown(f"""
                <div class="video-container">
                    <div style='padding: 1rem; background: rgba(59, 130, 246, 0.2); border-radius: 15px 15px 0 0;'>
                        <p style='color: #3b82f6; margin: 0; text-align: center; font-weight: bold;'>ğŸ¬ æ­£åœ¨ç”ŸæˆåŠ¨ç”»è§†é¢‘ï¼Œè¯·ç¨å€™...</p>
                    </div>
                </div>
                """, unsafe_allow_html=True)
                progress_bar.progress(20)
                
                # è°ƒç”¨Manimç”Ÿæˆè§†é¢‘
                success = generate_manim_video(module_key, scene_name, progress_bar, status_text)
                
                if success and video_file.exists():
                    st.markdown(f"""
                    <div class="video-container">
                        <div style='padding: 1rem; background: rgba(34, 197, 94, 0.2); border-radius: 15px 15px 0 0;'>
                            <p style='color: #22c55e; margin: 0; text-align: center; font-weight: bold;'>âœ… è§†é¢‘ç”Ÿæˆå®Œæˆï¼</p>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
                    progress_bar.progress(100)
                    
                    # æ’­æ”¾ç”Ÿæˆçš„è§†é¢‘
                    st.video(str(video_file))
                    
                    # ä¸‹è½½æŒ‰é’®
                    st.markdown("""
                    <div style='text-align: center; margin-top: 1rem;'>
                    """, unsafe_allow_html=True)
                    with open(video_file, 'rb') as f:
                        st.download_button(
                            label="ğŸ“¥ ä¸‹è½½è§†é¢‘",
                            data=f.read(),
                            file_name=f"{module_key}_{scene_name}.mp4",
                            mime="video/mp4",
                            use_container_width=True
                        )
                    st.markdown("</div>", unsafe_allow_html=True)
                else:
                    st.markdown(f"""
                    <div class="video-container">
                        <div style='padding: 1rem; background: rgba(239, 68, 68, 0.2); border-radius: 15px 15px 0 0;'>
                            <p style='color: #ef4444; margin: 0; text-align: center; font-weight: bold;'>âŒ è§†é¢‘ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯</p>
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
                    progress_bar.progress(0)
        
        except Exception as e:
            st.markdown(f"""
            <div class="video-container">
                <div style='padding: 1rem; background: rgba(239, 68, 68, 0.2); border-radius: 15px 15px 0 0;'>
                    <p style='color: #ef4444; margin: 0; text-align: center; font-weight: bold;'>âŒ æ’­æ”¾åœºæ™¯æ—¶å‡ºé”™ï¼š{e}</p>
                </div>
            </div>
            """, unsafe_allow_html=True)
            progress_bar.progress(0)
    
    with col_analysis:
        # æ–‡å­—è§£æéƒ¨åˆ†
        st.markdown(f"""
        <div style='background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); 
                   padding: 1rem; border-radius: 15px; margin-bottom: 1rem; border: 1px solid rgba(59, 130, 246, 0.2);'>
            <h3 style='color: {module["color"]}; margin: 0; text-align: center;'>ğŸ“– æ¦‚å¿µè§£æ</h3>
        </div>
        """, unsafe_allow_html=True)
        
        # åŸºæœ¬æ¦‚å¿µ
        st.markdown(f"""
        <div class="analysis-card">
            <div class="analysis-title">ğŸ¯ åŸºæœ¬æ¦‚å¿µ</div>
            <p style='color: #e0e0e0; line-height: 1.6;'>{scene_desc['description']}</p>
        </div>
        """, unsafe_allow_html=True)
        
        # æ ¸å¿ƒè¦ç‚¹
        if 'key_concepts' in scene_desc:
            st.markdown(f"""
            <div class="analysis-card">
                <div class="analysis-title">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</div>
            """, unsafe_allow_html=True)
            for i, concept in enumerate(scene_desc['key_concepts']):
                st.markdown(f"""
                <div class="list-item" style='border-left-color: {module["color"]};'>
                    <strong style='color: {module["color"]};'>{i+1}.</strong> {concept}
                </div>
                """, unsafe_allow_html=True)
            st.markdown("</div>", unsafe_allow_html=True)
        
        # æ•°å­¦å…¬å¼ï¼ˆä½¿ç”¨Streamlitçš„st.latexï¼‰
        if 'formula' in scene_desc and scene_desc['formula']:
            st.markdown(f"""
            <div class="analysis-card">
                <div class="analysis-title">ğŸ§® æ•°å­¦å…¬å¼</div>
            </div>
            """, unsafe_allow_html=True)
            
            # ä½¿ç”¨Streamlitçš„LaTeXæ¸²æŸ“
            formula_text = scene_desc['formula'].strip()
            if formula_text and formula_text != "ç›¸å…³æ•°å­¦å…¬å¼":
                try:
                    st.latex(formula_text)
                except Exception as e:
                    st.error(f"å…¬å¼æ¸²æŸ“é”™è¯¯: {e}")
                    st.code(formula_text)
        
        # ä¼˜ç‚¹å’Œç¼ºç‚¹
        col_adv, col_dis = st.columns(2)
        
        with col_adv:
            if 'advantages' in scene_desc:
                st.markdown(f"""
                <div class="analysis-card" style='background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);'>
                    <div class="analysis-title" style='color: #22c55e;'>âœ… ä¸»è¦ä¼˜ç‚¹</div>
                """, unsafe_allow_html=True)
                for advantage in scene_desc['advantages']:
                    st.markdown(f"""
                    <div style='margin: 0.3rem 0; padding: 0.3rem; color: #e0e0e0;'>
                        â€¢ {advantage}
                    </div>
                    """, unsafe_allow_html=True)
                st.markdown("</div>", unsafe_allow_html=True)
        
        with col_dis:
            if 'disadvantages' in scene_desc:
                st.markdown(f"""
                <div class="analysis-card" style='background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%);'>
                    <div class="analysis-title" style='color: #f59e0b;'>âš ï¸ æ³¨æ„äº‹é¡¹</div>
                """, unsafe_allow_html=True)
                for disadvantage in scene_desc['disadvantages']:
                    st.markdown(f"""
                    <div style='margin: 0.3rem 0; padding: 0.3rem; color: #e0e0e0;'>
                        â€¢ {disadvantage}
                    </div>
                    """, unsafe_allow_html=True)
                st.markdown("</div>", unsafe_allow_html=True)
        
        # åº”ç”¨åœºæ™¯
        if 'applications' in scene_desc:
            st.markdown(f"""
            <div class="analysis-card">
                <div class="analysis-title">ğŸ”¬ åº”ç”¨åœºæ™¯</div>
            """, unsafe_allow_html=True)
            for i, app in enumerate(scene_desc['applications']):
                st.markdown(f"""
                <div style='margin: 0.3rem 0; padding: 0.5rem; background: rgba(59, 130, 246, 0.05); 
                           border-radius: 8px; border-left: 3px solid {module["color"]};'>
                    <strong style='color: {module["color"]};'>åº”ç”¨ {i+1}:</strong> {app}
                </div>
                """, unsafe_allow_html=True)
            st.markdown("</div>", unsafe_allow_html=True)

def generate_manim_video(module_key, scene_name, progress_bar, status_text):
    """ä½¿ç”¨Manimç”Ÿæˆè§†é¢‘"""
    try:
        # æ„å»ºManimå‘½ä»¤
        scene_class_name = f"{scene_name.title().replace('_', '')}Scene"
        command = [
            "manim", 
            f"scenes.{module_key}.{scene_name}",
            scene_class_name,
            "-qm",  # é«˜è´¨é‡
            "--output_file", f"{module_key}_{scene_name}.mp4"
        ]
        
        status_text.text("ğŸ¬ æ‰§è¡ŒManimå‘½ä»¤...")
        progress_bar.progress(40)
        
        # æ‰§è¡Œå‘½ä»¤
        result = subprocess.run(
            command,
            cwd=Path(__file__).parent,
            capture_output=True,
            text=True,
            timeout=300  # 5åˆ†é’Ÿè¶…æ—¶
        )
        
        progress_bar.progress(80)
        
        if result.returncode == 0:
            status_text.text("âœ… Manimæ‰§è¡ŒæˆåŠŸï¼Œæ­£åœ¨å¤„ç†è¾“å‡º...")
            return True
        else:
            st.error(f"Manimæ‰§è¡Œå¤±è´¥ï¼š{result.stderr}")
            return False
    
    except subprocess.TimeoutExpired:
        st.error("è§†é¢‘ç”Ÿæˆè¶…æ—¶ï¼Œè¯·å°è¯•ç®€åŒ–åœºæ™¯æˆ–æ£€æŸ¥ä»£ç ")
        return False
    except Exception as e:
        st.error(f"ç”Ÿæˆè§†é¢‘æ—¶å‡ºé”™ï¼š{e}")
        return False

if __name__ == "__main__":
    main()

def display_learning_tips(module_key):
    """æ˜¾ç¤ºå­¦ä¹ å»ºè®®å’Œè·¯å¾„ä¿¡æ¯"""
    from learning_paths import LEARNING_PATHS, get_prerequisites
    from config import MODULES
    
    # æŸ¥æ‰¾è¯¥æ¨¡å—åœ¨å“ªäº›å­¦ä¹ è·¯å¾„ä¸­
    paths_containing = []
    for path_key, path in LEARNING_PATHS.items():
        for module in path.get('modules', []):
            if module['module'] == module_key:
                paths_containing.append({
                    'path_key': path_key,
                    'path_name': path['name'],
                    'module_info': module
                })
                break
    
    if paths_containing:
        st.markdown("### ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®")
        
        # åˆ›å»ºæ ‡ç­¾é¡µ
        tabs = st.tabs([p['path_name'] for p in paths_containing])
        
        for tab, path_info in zip(tabs, paths_containing):
            with tab:
                module_info = path_info['module_info']
                
                col1, col2 = st.columns([2, 1])
                
                with col1:
                    st.markdown(f"""
                    **ä¸ºä»€ä¹ˆå­¦è¿™ä¸ªï¼Ÿ**  
                    {module_info['why']}
                    
                    **æ ¸å¿ƒæ¦‚å¿µ**:  
                    {', '.join(f'`{c}`' for c in module_info['key_concepts'])}
                    
                    **æ¨èåœºæ™¯**:  
                    {', '.join(f'`{s}`' for s in module_info['scenes'])}
                    """)
                
                with col2:
                    st.metric("é¢„è®¡å­¦ä¹ æ—¶é—´", module_info['time'])
                    
                    # å…ˆä¿®è¦æ±‚
                    if module_info['prerequisites']:
                        prereq_names = []
                        for prereq in module_info['prerequisites']:
                            if prereq in MODULES:
                                prereq_names.append(MODULES[prereq]['name'])
                        
                        if prereq_names:
                            st.markdown("**å…ˆä¿®è¦æ±‚**:")
                            for prereq in prereq_names:
                                st.markdown(f"- {prereq}")
                    else:
                        st.info("âœ… æ— å…ˆä¿®è¦æ±‚")
                
                # å¦‚æœè¿˜æ²¡å¼€å§‹è¿™ä¸ªè·¯å¾„ï¼Œæä¾›å¼€å§‹æŒ‰é’®
                if st.session_state.get('current_path') != path_info['path_key']:
                    if st.button(f"å¼€å§‹ {path_info['path_name']}", key=f"start_path_{path_info['path_key']}"):
                        st.session_state['current_path'] = path_info['path_key']
                        st.session_state['completed_modules'] = set()
                        st.rerun()
    else:
        # è¯¥æ¨¡å—ä¸åœ¨ä»»ä½•é¢„å®šä¹‰è·¯å¾„ä¸­
        st.info("ğŸ’¡ æç¤º: è¿™æ˜¯ä¸€ä¸ªé«˜çº§æ¨¡å—ï¼Œä½ å¯ä»¥åœ¨æŒæ¡åŸºç¡€åæ¢ç´¢")
